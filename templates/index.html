<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Downloader - Èü≥‰πê‰∏ãËΩΩÂô®</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* Èü≥‰πêÊí≠ÊîæÂô®Ê†∑Âºè */
        .player-bar {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .progress-bar {
            appearance: none;
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            outline: none;
            cursor: pointer;
        }
        
        .progress-bar::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        
        /* ÊêúÁ¥¢ÁªìÊûúÂç°ÁâáÂä®Áîª */
        .search-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .search-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* È™®Êû∂Â±èÂä®Áîª */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Ê≠åÂçïÂç°ÁâáÂä®Áîª */
        .playlist-card {
            transition: all 0.3s ease;
        }
        
        .playlist-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Âä†ËΩΩÁä∂ÊÄÅÂä®Áîª */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ÂõæÁâáÂä†ËΩΩ‰ºòÂåñ */
        .img-loading {
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .img-error {
            background: #fee2e2;
            color: #dc2626;
        }
        
        /* ÊáíÂä†ËΩΩÂõæÁâáÊ†∑Âºè */
        .lazy-img-container {
            position: relative;
            overflow: hidden;
            background: #f3f4f6;
        }
        
        .lazy-img {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .lazy-img.loaded {
            opacity: 1;
        }
        
        .lazy-img-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #9ca3af;
        }
        
        .lazy-img-error {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #fee2e2;
            color: #dc2626;
            font-size: 0.875rem;
        }
        
        /* ÂõæÁâáÂä†ËΩΩÂä®Áîª */
        @keyframes imageShimmer {
            0% { background-position: -100% 0; }
            100% { background-position: 100% 0; }
        }
        
        .img-shimmer {
            background: linear-gradient(
                90deg,
                #f3f4f6 0%,
                #e5e7eb 20%,
                #f3f4f6 40%,
                #f3f4f6 100%
            );
            background-size: 200% 100%;
            animation: imageShimmer 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <nav class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-music mr-2"></i>
                    Music Downloader
                </h1>
                <div class="space-x-4">
                    <button @click="activeTab = 'search'" 
                            :class="activeTab === 'search' ? 'bg-white text-blue-600' : 'bg-blue-500'" 
                            class="px-4 py-2 rounded-lg transition">
                        <i class="fas fa-search mr-2"></i>ÊêúÁ¥¢
                    </button>
                    <button @click="activeTab = 'downloads'" 
                            :class="activeTab === 'downloads' ? 'bg-white text-blue-600' : 'bg-blue-500'" 
                            class="px-4 py-2 rounded-lg transition">
                        <i class="fas fa-download mr-2"></i>‰∏ãËΩΩ
                    </button>
                    <button @click="activeTab = 'library'" 
                            :class="activeTab === 'library' ? 'bg-white text-blue-600' : 'bg-blue-500'" 
                            class="px-4 py-2 rounded-lg transition">
                        <i class="fas fa-folder-open mr-2"></i>Èü≥‰πêÂ∫ì
                    </button>
                    <button @click="activeTab = 'favorites'" 
                            :class="activeTab === 'favorites' ? 'bg-white text-blue-600' : 'bg-blue-500'" 
                            class="px-4 py-2 rounded-lg transition">
                        <i class="fas fa-list mr-2"></i>Ê≠åÂçï
                    </button>
                    <button @click="activeTab = 'settings'" 
                            :class="activeTab === 'settings' ? 'bg-white text-blue-600' : 'bg-blue-500'" 
                            class="px-4 py-2 rounded-lg transition">
                        <i class="fas fa-cog mr-2"></i>ËÆæÁΩÆ
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto p-6 pb-32">
            <!-- ÊêúÁ¥¢È°µÈù¢ -->
            <div v-show="activeTab === 'search'" class="space-y-6">
                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4">üîç ÊêúÁ¥¢Èü≥‰πê</h2>
                    <div class="relative">
                        <div class="flex space-x-4">
                            <div class="flex-1 relative">
                                <input v-model="searchQuery" 
                                       @keyup.enter="searchMusic"
                                       @input="onSearchInput"
                                       @focus="showSearchHistory = true"
                                       @blur="hideSearchHistoryWithDelay"
                                       type="text" 
                                       placeholder="ËæìÂÖ•Ê≠åÊõ≤Âêç„ÄÅËâ∫ÊúØÂÆ∂Êàñ Spotify ÈìæÊé•..." 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                
                                <!-- ÊêúÁ¥¢ÂéÜÂè≤‰∏ãÊãâ -->
                                <div v-if="showSearchHistory && searchHistory.length > 0" 
                                     class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto">
                                    <div class="p-2 border-b border-gray-100">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium text-gray-600">ÊêúÁ¥¢ÂéÜÂè≤</span>
                                            <button @click="clearSearchHistory" 
                                                    class="text-xs text-red-600 hover:text-red-800">
                                                Ê∏ÖÈô§ÂéÜÂè≤
                                            </button>
                                        </div>
                                    </div>
                                    <div class="max-h-48 overflow-y-auto">
                                        <button v-for="(item, index) in searchHistory.slice(0, 10)" 
                                                :key="index"
                                                @click="selectSearchHistory(item)"
                                                class="w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center justify-between">
                                            <span class="text-sm">{{ item.query }}</span>
                                            <span class="text-xs text-gray-400">{{ item.count }}Ê¨°</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        <select v-model="searchLimit" 
                                class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="50">50È¶ñ</option>
                            <option value="100">100È¶ñ</option>
                            <option value="200">200È¶ñ</option>
                            <option value="500">500È¶ñ</option>
                        </select>
                        <button @click="searchMusic" 
                                :disabled="searching"
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition">
                            <i :class="searching ? 'fas fa-spinner loading-spinner' : 'fas fa-search'" class="mr-2"></i>
                            <span v-if="searching">ÊêúÁ¥¢‰∏≠...</span>
                            <span v-else>ÊêúÁ¥¢</span>
                        </button>
                    </div>
                    
                    <!-- ÊêúÁ¥¢Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                    <div v-if="searchCache.size > 0" class="mt-3 text-sm text-gray-600">
                        <i class="fas fa-history mr-1"></i>
                        Â∑≤ÁºìÂ≠ò {{ searchCache.size }} ‰∏™ÊêúÁ¥¢ÁªìÊûú
                    </div>
                    </div>
                    
                    <!-- È´òÁ∫ßÁ≠õÈÄâÈÄâÈ°π -->
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-medium text-gray-700">üéØ Á≤æÂáÜÁ≠õÈÄâ</h3>
                            <button @click="showAdvancedFilters = !showAdvancedFilters" 
                                    class="text-sm text-blue-600 hover:text-blue-800">
                                <span v-if="showAdvancedFilters">Êî∂Ëµ∑</span>
                                <span v-else>Â±ïÂºÄ</span>
                            </button>
                        </div>
                        <div v-if="showAdvancedFilters" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ÂõΩÂÆ∂Á≠õÈÄâ</label>
                                <select v-model="searchFilters.country" 
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg">
                                    <option value="">ÊâÄÊúâÂõΩÂÆ∂</option>
                                    <option value="china">‰∏≠ÂõΩ</option>
                                    <option value="korea">Èü©ÂõΩ</option>
                                    <option value="japan">Êó•Êú¨</option>
                                    <option value="usa">ÁæéÂõΩ</option>
                                    <option value="uk">Ëã±ÂõΩ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ËØ≠Ë®ÄÁ≠õÈÄâ</label>
                                <select v-model="searchFilters.language" 
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg">
                                    <option value="">ÊâÄÊúâËØ≠Ë®Ä</option>
                                    <option value="chinese">‰∏≠Êñá</option>
                                    <option value="korean">Èü©ËØ≠</option>
                                    <option value="japanese">Êó•ËØ≠</option>
                                    <option value="english">Ëã±ËØ≠</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ÂéªÈáçËÆæÁΩÆ</label>
                                <select v-model="searchFilters.deduplicate" 
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg">
                                    <option :value="true">ÂéªÈô§ÈáçÂ§ç</option>
                                    <option :value="false">‰øùÁïôÈáçÂ§ç</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ËØïÂê¨Á≠õÈÄâ</label>
                                <select v-model="searchFilters.preview_only" 
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg">
                                    <option :value="false">ÊòæÁ§∫ÂÖ®ÈÉ®</option>
                                    <option :value="true">‰ªÖÂèØËØïÂê¨</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Âø´ÈÄüÊêúÁ¥¢</label>
                                <div class="flex space-x-1">
                                    <button @click="quickSearch('ÂçéËØ≠')" 
                                            class="flex-1 px-2 py-1 text-xs bg-yellow-500 text-white rounded hover:bg-yellow-600">ÂçéËØ≠</button>
                                    <button @click="quickSearch('Èü©ËØ≠')" 
                                            class="flex-1 px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Èü©ËØ≠</button>
                                    <button @click="quickSearch('Êó•ËØ≠')" 
                                            class="flex-1 px-2 py-1 text-xs bg-pink-500 text-white rounded hover:bg-pink-600">Êó•ËØ≠</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÁÉ≠Èó®Èü≥‰πêÂø´Êç∑ÊåâÈíÆ -->
                    <div class="mt-4">
                        <h3 class="text-sm font-medium text-gray-700 mb-2">üåç ÁÉ≠Èó®Èü≥‰πêÊé¢Á¥¢</h3>
                        <div class="flex flex-wrap gap-2">
                            <button @click="searchCountryTop('korea')" 
                                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                <i class="fas fa-flag mr-1"></i>Èü©ÂõΩÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('japan')" 
                                    class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition">
                                <i class="fas fa-flag mr-1"></i>Êó•Êú¨ÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('turkey')" 
                                    class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition">
                                <i class="fas fa-flag mr-1"></i>ÂúüËÄ≥ÂÖ∂ÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('usa')" 
                                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                <i class="fas fa-flag mr-1"></i>Ê¨ßÁæéÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('uk')" 
                                    class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition">
                                <i class="fas fa-flag mr-1"></i>Ëã±ÂõΩÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('china')" 
                                    class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">
                                <i class="fas fa-flag mr-1"></i>ÂçéËØ≠ÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('taiwan')" 
                                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                                <i class="fas fa-flag mr-1"></i>Âè∞ÊπæÁÉ≠Èó®
                            </button>
                            <button @click="searchCountryTop('europe')" 
                                    class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                                <i class="fas fa-flag mr-1"></i>Ê¨ßÊ¥≤ÁÉ≠Èó®
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÊêúÁ¥¢ÁªìÊûú -->
                <div v-if="searchResults.length > 0" class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold">ÊêúÁ¥¢ÁªìÊûú ({{ searchResults.length }} È¶ñ)</h3>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-volume-up text-green-600 mr-1"></i>
                                {{ searchResults.filter(t => t.preview_url).length }} È¶ñÂèØËØïÂê¨ 
                                <span class="mx-2">|</span>
                                <i class="fas fa-volume-mute text-gray-400 mr-1"></i>
                                {{ searchResults.filter(t => !t.preview_url).length }} È¶ñÊó†È¢ÑËßà
                            </p>
                        </div>
                        <div class="flex space-x-2">
                            <!-- ÊâπÈáèÈÄâÊã©Êìç‰Ωú -->
                            <div class="flex space-x-2">
                                <button @click="selectAllTracks" 
                                        class="px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition text-sm">
                                    <i class="fas fa-check-square mr-1"></i>ÂÖ®ÈÄâ
                                </button>
                                <button @click="selectNoneTracks" 
                                        class="px-3 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition text-sm">
                                    <i class="fas fa-square mr-1"></i>ÂÖ®‰∏çÈÄâ
                                </button>
                                <button @click="toggleSelectTracks" 
                                        class="px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition text-sm">
                                    <i class="fas fa-exchange-alt mr-1"></i>ÂèçÈÄâ
                                </button>
                            </div>
                            
                            <!-- ÊâπÈáèÊìç‰Ωú -->
                            <div class="flex space-x-2">
                                <button @click="downloadSelectedTracks" 
                                        :disabled="batchDownloading || selectedTracks.length === 0"
                                        class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition text-sm">
                                    <i class="fas fa-download mr-1"></i>
                                    <span v-if="batchDownloading">‰∏ãËΩΩ‰∏≠...</span>
                                    <span v-else-if="selectedTracks.length > 0">‰∏ãËΩΩ ({{ selectedTracks.length }})</span>
                                    <span v-else>‰∏ãËΩΩ</span>
                                </button>
                                <button @click="openAddToPlaylistModal" 
                                        :disabled="selectedTracks.length === 0"
                                        class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 transition text-sm">
                                    <i class="fas fa-plus mr-1"></i>
                                    <span v-if="selectedTracks.length > 0">Âä†ÂÖ•Ê≠åÂçï ({{ selectedTracks.length }})</span>
                                    <span v-else>Âä†ÂÖ•Ê≠åÂçï</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊâπÈáè‰∏ãËΩΩËøõÂ∫¶ -->
                    <div v-if="batchDownloadProgress.show" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium">ÊâπÈáè‰∏ãËΩΩËøõÂ∫¶</span>
                            <span class="text-sm text-blue-600">{{ batchDownloadProgress.completed }}/{{ batchDownloadProgress.total }}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                 :style="{width: (batchDownloadProgress.completed / batchDownloadProgress.total * 100) + '%'}"></div>
                        </div>
                        <div class="mt-2 text-xs text-gray-600">
                            <div v-if="batchDownloadProgress.current">Ê≠£Âú®‰∏ãËΩΩ: {{ batchDownloadProgress.current }}</div>
                            <div v-if="batchDownloadProgress.failed.length > 0" class="text-red-600">
                                Â§±Ë¥• {{ batchDownloadProgress.failed.length }} È¶ñ
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
                        <div v-for="track in searchResults" :key="track.id" 
                             class="bg-white rounded-lg shadow-md p-3 search-card"
                             :class="{'ring-2 ring-blue-500': selectedTracks.includes(track.id)}">
                            <!-- ÈÄâÊã©Ê°ÜÔºàÂßãÁªàÊòæÁ§∫Ôºâ -->
                            <div class="flex justify-between items-start mb-2">
                                <input type="checkbox" 
                                       :value="track.id" 
                                       v-model="selectedTracks"
                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                <!-- ÂõΩÂÆ∂ËØ≠Ë®ÄÊ†áËØÜ -->
                                <div class="flex space-x-1 text-xs">
                                    <span v-if="track.country" class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                        {{ track.country }}
                                    </span>
                                    <span v-if="track.language" class="px-2 py-1 bg-green-100 text-green-800 rounded-full">
                                        {{ track.language }}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-2">
                                <div class="lazy-img-container w-12 h-12 rounded flex-shrink-0">
                                    <div v-if="!imageStates[track.id]?.loaded && !imageStates[track.id]?.error" 
                                         class="lazy-img-placeholder img-shimmer">
                                        <i class="fas fa-music text-gray-400"></i>
                                    </div>
                                    <div v-if="imageStates[track.id]?.error" 
                                         class="lazy-img-error">
                                        <i class="fas fa-image-slash mb-1"></i>
                                        <span class="text-xs">Âä†ËΩΩÂ§±Ë¥•</span>
                                    </div>
                                    <img :src="track.album_art || defaultAlbumArt" 
                                         :alt="track.name + ' Album Art'"
                                         @load="onImageLoad(track.id)"
                                         @error="onImageError(track.id, $event)"
                                         v-show="imageStates[track.id]?.loaded"
                                         class="lazy-img w-full h-full rounded object-cover"
                                         :class="{ 'loaded': imageStates[track.id]?.loaded }"
                                         loading="lazy">
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-1">
                                        <h4 class="font-medium text-sm truncate" :title="track.title">{{ track.title }}</h4>
                                        <i v-if="track.preview_url" 
                                           class="fas fa-volume-up text-green-600 text-xs" 
                                           title="ÂèØËØïÂê¨"></i>
                                        <i v-else 
                                           class="fas fa-volume-mute text-gray-400 text-xs" 
                                           title="Êó†ËØïÂê¨"></i>
                                    </div>
                                    <p class="text-gray-600 text-xs truncate" :title="track.artist">{{ track.artist }}</p>
                                    <p class="text-gray-500 text-xs truncate" :title="track.album">{{ track.album }}</p>
                                    <p class="text-gray-400 text-xs" v-if="track.duration">
                                        {{ formatDuration(track.duration) }}
                                    </p>
                                </div>
                            </div>
                            <div class="mt-2 space-y-1">
                                <!-- Á¨¨‰∏ÄË°åÔºöËØïÂê¨ÂíåÊµÅÂ™í‰Ωì -->
                                <div class="flex space-x-1">
                                    <button v-if="track.preview_url"
                                            @click="playPreview(track)" 
                                            class="flex-1 px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition">
                                        <i class="fas fa-headphones mr-1"></i>ËØïÂê¨
                                    </button>
                                    <div v-else class="flex-1 px-2 py-1 text-xs bg-gray-300 text-gray-600 rounded text-center">
                                        <i class="fas fa-headphones-slash mr-1"></i>Êó†È¢ÑËßà
                                    </div>
                                    <button @click="playDirectStream(track)" 
                                            :disabled="streamingTracks.includes(track.id)"
                                            class="flex-1 px-2 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-gray-400 transition">
                                        <i class="fas fa-stream mr-1"></i>
                                        <span v-if="streamingTracks.includes(track.id)">Ëé∑Âèñ‰∏≠</span>
                                        <span v-else>ÊµÅÂ™í‰Ωì</span>
                                    </button>
                                </div>
                                <!-- Á¨¨‰∫åË°åÔºö‰∏ãËΩΩÂíåÊî∂Ëóè -->
                                <div class="flex space-x-1">
                                    <button @click="downloadTrack(track)" 
                                            :disabled="downloadingTracks.includes(track.id)"
                                            class="flex-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 transition">
                                        <i class="fas fa-download mr-1"></i>
                                        <span v-if="downloadingTracks.includes(track.id)">‰∏ãËΩΩ‰∏≠</span>
                                        <span v-else>‰∏ãËΩΩ</span>
                                    </button>
                                    <button @click="addToFavorites(track)" 
                                            class="flex-1 px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 transition">
                                        <i class="fas fa-heart mr-1"></i>Êî∂Ëóè
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰∏ãËΩΩÈ°µÈù¢ -->
            <div v-show="activeTab === 'downloads'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">üì• ‰∏ãËΩΩ‰ªªÂä°</h2>
                        <div class="flex space-x-2">
                            <button @click="clearDownloadTasks('failed')" 
                                    class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                                <i class="fas fa-trash-alt mr-2"></i>Ê∏ÖÈô§Â§±Ë¥•ËÆ∞ÂΩï
                            </button>
                            <button @click="clearDownloadTasks('completed')" 
                                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                <i class="fas fa-check-circle mr-2"></i>Ê∏ÖÈô§ÊàêÂäüËÆ∞ÂΩï
                            </button>
                            <button @click="clearDownloadTasks()" 
                                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                                <i class="fas fa-trash mr-2"></i>Ê∏ÖÈô§ÊâÄÊúâËÆ∞ÂΩï
                            </button>
                        </div>
                    </div>
                    
                    <!-- Á≥ªÁªüÁä∂ÊÄÅ -->
                    <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                                <span class="text-sm">
                                    <span v-if="systemInfo.has_ffmpeg" class="text-green-600">
                                        ‚úÖ {{ systemInfo.format_note }}
                                    </span>
                                    <span v-else class="text-orange-600">
                                        ‚ö†Ô∏è {{ systemInfo.format_note }}
                                    </span>
                                </span>
                            </div>
                            <div class="flex space-x-1">
                                <span v-for="format in systemInfo.supported_formats" :key="format"
                                      :class="format === systemInfo.preferred_format ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'"
                                      class="px-2 py-1 rounded text-xs">
                                    {{ format.toUpperCase() }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- ‰∏ãËΩΩË°®Âçï -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-bold mb-3">Âø´ÈÄü‰∏ãËΩΩ</h3>
                        <div class="space-y-4">
                            <input v-model="downloadForm.url" 
                                   type="text" 
                                   placeholder="Á≤òË¥¥ Spotify ÈìæÊé•..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                            <div class="grid grid-cols-2 gap-4">
                                <select v-model="downloadForm.format" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg">
                                    <option value="mp3">MP3</option>
                                    <option value="flac">FLAC</option>
                                    <option value="m4a">M4A</option>
                                </select>
                                <select v-model="downloadForm.quality" 
                                        class="px-4 py-2 border border-gray-300 rounded-lg">
                                    <option value="128k">128k</option>
                                    <option value="320k">320k</option>
                                    <option value="best">ÊúÄ‰Ω≥Èü≥Ë¥®</option>
                                </select>
                            </div>
                            <button @click="startDownload" 
                                    :disabled="downloading"
                                    class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition">
                                <i class="fas fa-download mr-2"></i>
                                <span v-if="downloading">‰∏ãËΩΩ‰∏≠...</span>
                                <span v-else>ÂºÄÂßã‰∏ãËΩΩ</span>
                            </button>
                        </div>
                    </div>

                    <!-- ‰∏ãËΩΩÂàóË°® -->
                    <div class="space-y-3">
                        <div v-for="task in downloadTasks" :key="task.id" 
                             class="border rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-3 flex-1">
                                    <!-- ‰∏ìËæëÂ∞ÅÈù¢ -->
                                    <div class="lazy-img-container w-12 h-12 rounded-lg">
                                        <div v-if="!imageStates['task_' + task.id]?.loaded && !imageStates['task_' + task.id]?.error" 
                                             class="lazy-img-placeholder img-shimmer">
                                            <i class="fas fa-music text-gray-400"></i>
                                        </div>
                                        <div v-if="imageStates['task_' + task.id]?.error" 
                                             class="lazy-img-error">
                                            <i class="fas fa-image-slash mb-1"></i>
                                            <span class="text-xs">Âä†ËΩΩÂ§±Ë¥•</span>
                                        </div>
                                        <img v-if="task.metadata && task.metadata.album_art"
                                             :src="task.metadata.album_art" 
                                             :alt="(task.metadata.title || 'Unknown') + ' Album Art'"
                                             @load="onImageLoad('task_' + task.id)"
                                             @error="onImageError('task_' + task.id, $event)"
                                             v-show="imageStates['task_' + task.id]?.loaded"
                                             class="lazy-img w-full h-full rounded-lg object-cover"
                                             :class="{ 'loaded': imageStates['task_' + task.id]?.loaded }"
                                             loading="lazy">
                                        <img v-else
                                             :src="defaultAlbumArt" 
                                             alt="Default Album Art"
                                             class="w-full h-full rounded-lg object-cover">
                                    </div>
                                    
                                    <div class="flex-1">
                                        <p class="font-medium">{{ getTaskTitle(task) }}</p>
                                        <p class="text-sm text-gray-600">{{ getTaskArtist(task) }}</p>
                                        <p class="text-xs text-gray-500">{{ getTaskAlbum(task) }}</p>
                                        <p class="text-xs text-gray-400 mt-1">{{ formatDate(task.created_at) }}</p>
                                        
                                        <!-- ÊâπÈáè‰∏ãËΩΩËøõÂ∫¶‰ø°ÊÅØ -->
                                        <div v-if="task.total_songs > 1" class="text-xs text-blue-600 mt-1">
                                            {{ task.completed_songs || 0 }}/{{ task.total_songs }} È¶ñ
                                            <span v-if="task.failed_songs > 0" class="text-red-600">
                                                ({{ task.failed_songs }} È¶ñÂ§±Ë¥•)
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span :class="getStatusColor(task.status)" 
                                          class="px-3 py-1 rounded-full text-sm">
                                        {{ getStatusText(task.status) }}
                                    </span>
                                    <div v-if="task.status === 'processing'" class="mt-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                                 :style="{width: task.progress + '%'}"></div>
                                        </div>
                                        <p class="text-xs text-gray-600 mt-1">{{ task.progress }}%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Èü≥‰πêÂ∫ìÈ°µÈù¢ -->
            <div v-show="activeTab === 'library'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">üéµ ÊàëÁöÑÈü≥‰πêÂ∫ì</h2>
                        <div class="flex space-x-2">
                            <button @click="activeTab = 'favorites'" 
                                    class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                                <i class="fas fa-list mr-2"></i>ÁÆ°ÁêÜÊ≠åÂçï
                            </button>
                            <button @click="loadLibrary" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-sync mr-2"></i>Âà∑Êñ∞
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÂàÜÁ±ªËøáÊª§ -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊµÅÊ¥æ</label>
                            <select v-model="libraryFilters.genre" @change="filterLibrary" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">ÊâÄÊúâÊµÅÊ¥æ</option>
                                <option v-for="genre in availableGenres" :key="genre" :value="genre">
                                    {{ genre }}
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂõΩÂÆ∂/Âú∞Âå∫</label>
                            <select v-model="libraryFilters.country" @change="filterLibrary" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">ÊâÄÊúâÂõΩÂÆ∂</option>
                                <option v-for="country in availableCountries" :key="country" :value="country">
                                    {{ country }}
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ËØ≠Ë®Ä</label>
                            <select v-model="libraryFilters.language" @change="filterLibrary" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">ÊâÄÊúâËØ≠Ë®Ä</option>
                                <option v-for="language in availableLanguages" :key="language" :value="language">
                                    {{ language }}
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊÉÖÁª™</label>
                            <select v-model="libraryFilters.mood" @change="filterLibrary" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">ÊâÄÊúâÊÉÖÁª™</option>
                                <option v-for="mood in availableMoods" :key="mood" :value="mood">
                                    {{ mood }}
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ÊêúÁ¥¢Ê°Ü -->
                    <div class="mb-4">
                        <input v-model="librarySearch" @input="filterLibrary" 
                               type="text" 
                               placeholder="ÊêúÁ¥¢Ê≠åÊõ≤„ÄÅËâ∫ÊúØÂÆ∂Êàñ‰∏ìËæë..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    
                    <!-- Èü≥‰πêÂ∫ìÂàóË°®ÔºàËØ¶ÁªÜËßÜÂõæÔºâ -->
                    <div class="space-y-3">
                        <div v-for="song in library" :key="song.id" 
                             class="flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50">
                            <div class="flex items-center space-x-4 flex-1">
                                <div class="lazy-img-container w-20 h-20 rounded-lg">
                                    <div v-if="!imageStates['lib_' + song.id]?.loaded && !imageStates['lib_' + song.id]?.error" 
                                         class="lazy-img-placeholder img-shimmer">
                                        <i class="fas fa-music text-gray-400 text-xl"></i>
                                    </div>
                                    <div v-if="imageStates['lib_' + song.id]?.error" 
                                         class="lazy-img-error">
                                        <i class="fas fa-image-slash mb-1"></i>
                                        <span class="text-xs">Âä†ËΩΩÂ§±Ë¥•</span>
                                    </div>
                                    <img :src="song.album_art_url || defaultAlbumArt" 
                                         :alt="song.title + ' Album Art'"
                                         @load="onImageLoad('lib_' + song.id)"
                                         @error="onImageError('lib_' + song.id, $event)"
                                         v-show="imageStates['lib_' + song.id]?.loaded"
                                         class="lazy-img w-full h-full rounded-lg object-cover"
                                         :class="{ 'loaded': imageStates['lib_' + song.id]?.loaded }"
                                         loading="lazy">
                                </div>
                                <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-2">
                                    <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                                    <div>
                                        <p class="font-medium text-lg">{{ song.title }}</p>
                                        <p class="text-sm text-gray-600">üé§ {{ song.artist }}</p>
                                        <p class="text-xs text-gray-500">üíø {{ song.album || 'Êú™Áü•‰∏ìËæë' }}</p>
                                        <p class="text-xs text-gray-400" v-if="song.year">üìÖ {{ song.year }}Âπ¥</p>
                                    </div>
                                    
                                    <!-- Êó∂ÈïøÂíåÊ†ºÂºè‰ø°ÊÅØ -->
                                    <div class="text-sm">
                                        <p class="text-gray-700">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span v-if="song.duration">Êó∂Èïø: {{ formatDuration(song.duration) }}</span>
                                            <span v-else>Êó∂Èïø: Êú™Áü•</span>
                                        </p>
                                        <p class="text-gray-600" v-if="song.preview_url">
                                            <i class="fas fa-headphones mr-1"></i>
                                            ËØïÂê¨: 30Áßí
                                        </p>
                                        <p class="text-gray-600" v-if="song.file_path">
                                            <i class="fas fa-file-audio mr-1"></i>
                                            Êñá‰ª∂: {{ getShortFilename(song.file_path) }}
                                            <span v-if="getFileFormat(song.file_path)" 
                                                  :class="getFormatColor(getFileFormat(song.file_path))"
                                                  class="ml-1 px-2 py-0.5 rounded text-xs">
                                                {{ getFileFormat(song.file_path).toUpperCase() }}
                                            </span>
                                        </p>
                                        <p class="text-gray-500 text-xs" v-if="song.file_size">
                                            <i class="fas fa-hdd mr-1"></i>
                                            Â§ßÂ∞è: {{ formatFileSize(song.file_size) }}
                                        </p>
                                    </div>
                                    
                                    <!-- ÂàÜÁ±ª‰ø°ÊÅØ -->
                                    <div class="text-sm">
                                        <div class="flex flex-wrap gap-1">
                                            <span v-if="song.genre" class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">
                                                {{ song.genre }}
                                            </span>
                                            <span v-if="song.country" class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">
                                                {{ song.country }}
                                            </span>
                                            <span v-if="song.language" class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">
                                                {{ song.language }}
                                            </span>
                                            <span v-if="song.mood" class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs">
                                                {{ song.mood }}
                                            </span>
                                        </div>
                                        <p class="text-xs text-gray-400 mt-1">
                                            <i class="fas fa-calendar-plus mr-1"></i>
                                            Ê∑ªÂä†‰∫é: {{ formatDate(song.created_at) }}
                                        </p>
                                        <p class="text-xs text-gray-400" v-if="song.downloaded_at">
                                            <i class="fas fa-download mr-1"></i>
                                            ‰∏ãËΩΩ‰∫é: {{ formatDate(song.downloaded_at) }}
                                        </p>
                                        <!-- ÊâÄÂ±ûÊ≠åÂçï -->
                                        <div v-if="getSongPlaylists(song.id).length > 0" class="mt-2">
                                            <p class="text-xs text-gray-500 mb-1">
                                                <i class="fas fa-list mr-1"></i>ÊâÄÂ±ûÊ≠åÂçï:
                                            </p>
                                            <div class="flex flex-wrap gap-1">
                                                <span v-for="playlist in getSongPlaylists(song.id)" :key="playlist.id"
                                                      class="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded-full text-xs cursor-pointer hover:bg-indigo-200"
                                                      @click="showPlaylistDetail(playlist.id)">
                                                    {{ playlist.name }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <!-- ËØïÂê¨ÊåâÈíÆ -->
                                <button @click="playPreview(song)" 
                                        v-if="song.preview_url"
                                        class="px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-headphones"></i> ËØïÂê¨
                                </button>
                                <!-- Êú¨Âú∞Êí≠ÊîæÊåâÈíÆ -->
                                <button @click="playSong(song)" 
                                        v-if="song.file_path"
                                        class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                    <i class="fas fa-play"></i> Êí≠Êîæ
                                </button>
                                <!-- ÈáçÊñ∞‰∏ãËΩΩÊåâÈíÆ -->
                                <button @click="downloadSong(song)" 
                                        v-if="!song.file_path"
                                        class="px-3 py-1 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                                    <i class="fas fa-download"></i> ‰∏ãËΩΩ
                                </button>
                                <!-- Ê∑ªÂä†Âà∞Êî∂ËóèÊåâÈíÆ -->
                                <button @click="addSongToFavorites(song)" 
                                        class="px-3 py-1 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                                    <i class="fas fa-heart"></i> Êî∂Ëóè
                                </button>
                                <!-- Âà†Èô§ÊåâÈíÆ -->
                                <button @click="deleteSong(song)" 
                                        class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Êî∂ËóèÈ°µÈù¢ -->
        <div v-show="activeTab === 'favorites'" class="space-y-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">üéµ ÊàëÁöÑÊ≠åÂçï</h2>
                    <div class="flex space-x-2">
                        <button @click="cleanupEmptyPlaylists" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            <i class="fas fa-trash mr-2"></i>Ê∏ÖÁêÜÁ©∫Ê≠åÂçï
                        </button>
                        <button @click="showCreatePlaylistModal = true" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-plus mr-2"></i>Êñ∞Âª∫Ê≠åÂçï
                        </button>
                    </div>
                </div>
                
                <!-- Ê≠åÂçïÂä†ËΩΩÁä∂ÊÄÅ -->
                <div v-if="playlistsLoading" class="space-y-4">
                    <div v-for="i in 3" :key="i" class="border rounded-lg p-4">
                        <div class="animate-pulse">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 bg-gray-300 rounded skeleton"></div>
                                <div class="flex-1">
                                    <div class="h-5 bg-gray-300 rounded skeleton mb-2" style="width: 60%"></div>
                                    <div class="h-4 bg-gray-300 rounded skeleton mb-2" style="width: 40%"></div>
                                    <div class="flex space-x-2">
                                        <div class="h-5 w-12 bg-gray-300 rounded-full skeleton"></div>
                                        <div class="h-5 w-16 bg-gray-300 rounded-full skeleton"></div>
                                    </div>
                                </div>
                                <div class="w-6 h-6 bg-gray-300 rounded skeleton"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Á©∫Áä∂ÊÄÅ -->
                <div v-else-if="!playlistsLoading && userPlaylists.length === 0" class="text-center py-12">
                    <i class="fas fa-music text-gray-300 text-6xl mb-4"></i>
                    <p class="text-gray-500 mb-4">ËøòÊ≤°ÊúâÊ≠åÂçï</p>
                    <button @click="showCreatePlaylistModal = true" 
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        ÂàõÂª∫Á¨¨‰∏Ä‰∏™Ê≠åÂçï
                    </button>
                </div>
                
                <!-- Ê≠åÂçïÂàóË°® -->
                <div v-else class="space-y-4">
                    <div v-for="playlist in userPlaylists" :key="playlist.id" 
                         class="border rounded-lg p-4 cursor-pointer playlist-card"
                         @click="togglePlaylistExpansion(playlist)">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-list text-blue-600"></i>
                                <div>
                                    <h3 class="font-medium text-lg">{{ playlist.name }}</h3>
                                    <p class="text-sm text-gray-600">{{ playlist.total_tracks }} È¶ñÊ≠åÊõ≤</p>
                                    <div class="flex space-x-2 mt-1">
                                        <span v-if="playlist.country" class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                            {{ playlist.country }}
                                        </span>
                                        <span v-if="playlist.category" class="text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded-full">
                                            {{ playlist.category }}
                                        </span>
                                        <span v-if="playlist.language" class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                                            {{ playlist.language }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click.stop="deletePlaylist(playlist.id)" 
                                        v-if="playlist.id"
                                        class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <i :class="currentFavoriteList?.id === playlist.id ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" 
                                   class="text-gray-400"></i>
                            </div>
                        </div>
                        
                        <!-- Ê≠åÂçïÂÜÖÂÆπ -->
                        <div v-if="currentFavoriteList?.id === playlist.id" class="mt-4 border-t pt-4">
                            <!-- Ê≠åÊõ≤Âä†ËΩΩÁä∂ÊÄÅ -->
                            <div v-if="playlistSongsLoading[playlist.id]" class="space-y-3">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="h-8 bg-gray-300 rounded skeleton" style="width: 200px"></div>
                                    <div class="h-6 bg-gray-300 rounded skeleton" style="width: 100px"></div>
                                </div>
                                <div v-for="i in 3" :key="i" class="bg-gray-50 rounded-lg p-3 border">
                                    <div class="flex items-start space-x-2">
                                        <div class="w-12 h-12 bg-gray-300 rounded skeleton"></div>
                                        <div class="flex-1">
                                            <div class="h-4 bg-gray-300 rounded skeleton mb-1" style="width: 70%"></div>
                                            <div class="h-3 bg-gray-300 rounded skeleton mb-1" style="width: 50%"></div>
                                            <div class="h-3 bg-gray-300 rounded skeleton" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Á©∫Áä∂ÊÄÅ -->
                            <div v-else-if="!playlist.songs || playlist.songs.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-music-slash text-gray-300 text-3xl mb-2"></i>
                                <p>Ëøô‰∏™Ê≠åÂçïËøòÊ≤°ÊúâÊ≠åÊõ≤</p>
                            </div>
                            
                            <!-- Ê≠åÊõ≤ÂàóË°® -->
                            <div v-else>
                                <!-- ÊâπÈáèÊìç‰ΩúÊåâÈíÆ -->
                                <div class="mb-4 flex justify-between items-center">
                                    <div class="flex space-x-2">
                                        <button @click="playAllInPlaylist(playlist)" 
                                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                            <i class="fas fa-play-circle mr-2"></i>Êí≠ÊîæÂÖ®ÈÉ®
                                        </button>
                                        <button @click="shufflePlayPlaylist(playlist)" 
                                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                                            <i class="fas fa-random mr-2"></i>ÈöèÊú∫Êí≠Êîæ
                                        </button>
                                        <button @click="downloadAllInPlaylist(playlist)" 
                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                            <i class="fas fa-download mr-2"></i>‰∏ãËΩΩÂÖ®ÈÉ®
                                        </button>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        ÂÖ± {{ playlist.songs ? playlist.songs.length : 0 }} È¶ñÊ≠åÊõ≤
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                <div v-for="track in playlist.songs" :key="track.id" 
                                     class="bg-gray-50 rounded-lg p-3 border">
                                    <div class="flex items-start space-x-2">
                                        <div class="lazy-img-container w-12 h-12 rounded flex-shrink-0">
                                            <div v-if="!imageStates['pl_' + track.id]?.loaded && !imageStates['pl_' + track.id]?.error" 
                                                 class="lazy-img-placeholder img-shimmer">
                                                <i class="fas fa-music text-gray-400"></i>
                                            </div>
                                            <div v-if="imageStates['pl_' + track.id]?.error" 
                                                 class="lazy-img-error">
                                                <i class="fas fa-image-slash mb-1"></i>
                                                <span class="text-xs">Âä†ËΩΩÂ§±Ë¥•</span>
                                            </div>
                                            <img :src="track.album_art || defaultAlbumArt" 
                                                 :alt="track.name + ' Album Art'"
                                                 @load="onImageLoad('pl_' + track.id)"
                                                 @error="onImageError('pl_' + track.id, $event)"
                                                 v-show="imageStates['pl_' + track.id]?.loaded"
                                                 class="lazy-img w-full h-full rounded object-cover"
                                                 :class="{ 'loaded': imageStates['pl_' + track.id]?.loaded }"
                                                 loading="lazy">
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <h4 class="font-medium text-sm truncate" :title="track.title">{{ track.title }}</h4>
                                            <p class="text-gray-600 text-xs truncate" :title="track.artist">{{ track.artist }}</p>
                                            <p class="text-gray-500 text-xs truncate" :title="track.album">{{ track.album }}</p>
                                        </div>
                                    </div>
                                    <div class="mt-2 flex space-x-1">
                                        <button @click="playPreview(track)" 
                                                v-if="track.preview_url"
                                                class="flex-1 px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition">
                                            <i class="fas fa-headphones mr-1"></i>ËØïÂê¨
                                        </button>
                                        <button @click="downloadTrack(track)" 
                                                class="flex-1 px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition">
                                            <i class="fas fa-download mr-1"></i>‰∏ãËΩΩ
                                        </button>
                                        <button @click="removeTrackFromList(track, list)" 
                                                class="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÂàõÂª∫Êî∂ËóèÂàóË°®Ê®°ÊÄÅÊ°Ü -->
        <div v-if="showCreateListModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="showCreateListModal = false">
            <div class="bg-white rounded-lg p-6 w-96" @click.stop>
                <h3 class="text-lg font-bold mb-4">ÂàõÂª∫Êñ∞ÁöÑÊî∂ËóèÂàóË°®</h3>
                <input v-model="newListName" 
                       @keyup.enter="createNewFavoriteList"
                       type="text" 
                       placeholder="ËæìÂÖ•ÂàóË°®ÂêçÁß∞..." 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4">
                <div class="flex justify-end space-x-2">
                    <button @click="showCreateListModal = false" 
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
                        ÂèñÊ∂à
                    </button>
                    <button @click="createNewFavoriteList" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        ÂàõÂª∫
                    </button>
                </div>
            </div>
        </div>

        <!-- ËÆæÁΩÆÈ°µÈù¢ -->
        <div v-show="activeTab === 'settings'" class="space-y-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-6">‚öôÔ∏è Êí≠ÊîæËÆæÁΩÆ</h2>
                
                <!-- ËØïÂê¨ËÆæÁΩÆ -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">ËØïÂê¨ËÆæÁΩÆ</h3>
                    <div class="bg-gray-50 rounded-lg p-4 space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Spotify ËØïÂê¨Êó∂Èïø</label>
                                <p class="text-xs text-gray-500">Spotify ÂÆòÊñπÊèê‰æõÁöÑËØïÂê¨ÁâáÊÆµÂõ∫ÂÆö‰∏∫ 30 Áßí</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    30 Áßí (Âõ∫ÂÆö)
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÊµÅÂ™í‰ΩìÊí≠ÊîæËÆæÁΩÆ -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">ÊµÅÂ™í‰ΩìÊí≠ÊîæËÆæÁΩÆ</h3>
                    <div class="bg-gray-50 rounded-lg p-4 space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">ÂêØÁî®ËØïÂê¨Ê®°Âºè</label>
                                <p class="text-xs text-gray-500">Âú®ÊµÅÂ™í‰ΩìÊí≠Êîæ‰∏≠ÂêØÁî®ÂÆöÊó∂ÂÅúÊ≠¢ÂäüËÉΩ</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="playSettings.streamPreviewMode" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div v-if="playSettings.streamPreviewMode">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊµÅÂ™í‰ΩìËØïÂê¨Êó∂Èïø (Áßí)</label>
                            <div class="flex items-center space-x-4">
                                <input type="range" 
                                       v-model="playSettings.previewDuration" 
                                       min="15" 
                                       max="120" 
                                       step="5"
                                       class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <span class="min-w-[60px] text-sm font-medium text-gray-900">{{ playSettings.previewDuration }} Áßí</span>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>15s</span>
                                <span>120s</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Ëá™Âä®ÂÅúÊ≠¢ËØïÂê¨</label>
                                <p class="text-xs text-gray-500">ËØïÂê¨Êó∂Èó¥Âà∞ËææÂêéËá™Âä®ÂÅúÊ≠¢Êí≠Êîæ</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="playSettings.autoStop" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Êí≠ÊîæÊ®°ÂºèËØ¥Êòé -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">Êí≠ÊîæÊ®°ÂºèËØ¥Êòé</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-play text-green-600 mr-2"></i>
                                <h4 class="font-medium text-green-800">ËØïÂê¨Ê®°Âºè</h4>
                            </div>
                            <p class="text-sm text-green-700">‰ΩøÁî® Spotify ÂÆòÊñπ 30 ÁßíËØïÂê¨ÁâáÊÆµÔºåÂìçÂ∫îÊúÄÂø´</p>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-stream text-purple-600 mr-2"></i>
                                <h4 class="font-medium text-purple-800">ÊµÅÂ™í‰ΩìÊí≠Êîæ</h4>
                            </div>
                            <p class="text-sm text-purple-700">Âú®Á∫øÊí≠ÊîæÂÆåÊï¥Ê≠åÊõ≤ÔºåÊó†ÈúÄ‰∏ãËΩΩÂà∞Êú¨Âú∞</p>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-file-audio text-blue-600 mr-2"></i>
                                <h4 class="font-medium text-blue-800">Êú¨Âú∞Êí≠Êîæ</h4>
                            </div>
                            <p class="text-sm text-blue-700">Êí≠ÊîæÂ∑≤‰∏ãËΩΩÁöÑÊú¨Âú∞Êñá‰ª∂ÔºåÈü≥Ë¥®ÊúÄ‰Ω≥</p>
                        </div>
                    </div>
                </div>
                
                <!-- ‰øùÂ≠òËÆæÁΩÆ -->
                <div class="flex justify-end">
                    <button @click="saveSettings" 
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-save mr-2"></i>‰øùÂ≠òËÆæÁΩÆ
                    </button>
                </div>
            </div>
        </div>

        <!-- Èü≥‰πêÊí≠ÊîæÂô®ÔºàÂõ∫ÂÆöÂú®Â∫ïÈÉ®Ôºâ -->
        <div v-if="currentTrack" class="fixed bottom-0 left-0 right-0 player-bar shadow-lg">
            <div class="container mx-auto p-4">
                <div class="flex items-center space-x-4">
                    <!-- Ê≠åÊõ≤‰ø°ÊÅØ -->
                    <div class="flex items-center space-x-3 w-64">
                        <div class="lazy-img-container w-12 h-12 rounded-lg">
                            <div v-if="!imageStates['player_' + currentTrack.id]?.loaded && !imageStates['player_' + currentTrack.id]?.error" 
                                 class="lazy-img-placeholder img-shimmer">
                                <i class="fas fa-music text-gray-400"></i>
                            </div>
                            <div v-if="imageStates['player_' + currentTrack.id]?.error" 
                                 class="lazy-img-error">
                                <i class="fas fa-image-slash mb-1"></i>
                            </div>
                            <img :src="currentTrack.album_art || defaultAlbumArt" 
                                 :alt="currentTrack.name + ' Album Art'"
                                 @load="onImageLoad('player_' + currentTrack.id)"
                                 @error="onImageError('player_' + currentTrack.id, $event)"
                                 v-show="imageStates['player_' + currentTrack.id]?.loaded"
                                 class="lazy-img w-full h-full rounded-lg object-cover"
                                 :class="{ 'loaded': imageStates['player_' + currentTrack.id]?.loaded }"
                                 loading="lazy">
                        </div>
                        <div>
                            <p class="font-medium text-sm">{{ currentTrack.title }}</p>
                            <p class="text-xs text-gray-600">{{ currentTrack.artist }}</p>
                            <p class="text-xs" :class="getPlayModeColor()">
                                <i :class="getPlayModeIcon()" class="mr-1"></i>
                                {{ getPlayModeText() }}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Êí≠ÊîæÊéßÂà∂ -->
                    <div class="flex-1 flex flex-col items-center">
                        <div class="flex items-center space-x-4 mb-2">
                            <button @click="previousTrack" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button @click="togglePlay" 
                                    class="w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition">
                                <i :class="playing ? 'fas fa-pause' : 'fas fa-play'"></i>
                            </button>
                            <button @click="nextTrack" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-step-forward"></i>
                            </button>
                            <!-- ÈáçÂ§çÊ®°ÂºèÊåâÈíÆ -->
                            <button @click="toggleRepeatMode" class="text-gray-600 hover:text-gray-800">
                                <i :class="getRepeatIcon()" :title="getRepeatTitle()"></i>
                            </button>
                            <!-- ÈöèÊú∫Ê®°ÂºèÊåâÈíÆ -->
                            <button @click="toggleShuffleMode" 
                                    :class="shuffleMode ? 'text-blue-600' : 'text-gray-600'"
                                    class="hover:text-gray-800">
                                <i class="fas fa-random" title="ÈöèÊú∫Êí≠Êîæ"></i>
                            </button>
                        </div>
                        
                        <!-- ËøõÂ∫¶Êù° -->
                        <div class="w-full flex items-center space-x-2">
                            <span class="text-xs text-gray-600">{{ formatTime(currentTime) }}</span>
                            <input type="range" 
                                   v-model="currentTime" 
                                   :max="duration"
                                   @input="seekTo"
                                   class="progress-bar flex-1">
                            <span class="text-xs text-gray-600">{{ formatTime(duration) }}</span>
                        </div>
                    </div>
                    
                    <!-- Èü≥ÈáèÊéßÂà∂ -->
                    <div class="flex items-center space-x-2 w-32">
                        <i class="fas fa-volume-up text-gray-600"></i>
                        <input type="range" 
                               v-model="volume" 
                               max="100"
                               @input="changeVolume"
                               class="progress-bar flex-1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Èü≥È¢ëÂÖÉÁ¥† -->
        <audio ref="audioPlayer" 
               @timeupdate="updateTime" 
               @loadedmetadata="onLoadedMetadata"
               @ended="onEnded"></audio>
        
        <!-- Ê∑ªÂä†Âà∞Ê≠åÂçïÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showAddToPlaylistModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ê∑ªÂä†Âà∞Ê≠åÂçï</h3>
                    <button @click="showAddToPlaylistModal = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-3">Â∑≤ÈÄâÊã© {{ selectedTracks.length }} È¶ñÊ≠åÊõ≤</p>
                    
                    <!-- ÂàõÂª∫Êñ∞Ê≠åÂçïÊåâÈíÆ -->
                    <button @click="showCreatePlaylistModal = true; showAddToPlaylistModal = false" 
                            class="w-full mb-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        <i class="fas fa-plus mr-2"></i>ÂàõÂª∫Êñ∞Ê≠åÂçï
                    </button>
                    
                    <!-- Áé∞ÊúâÊ≠åÂçïÂàóË°® -->
                    <div v-if="userPlaylists.length > 0">
                        <p class="text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©Áé∞ÊúâÊ≠åÂçïÔºö</p>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                            <div v-for="playlist in userPlaylists" :key="playlist.id" 
                                 @click="selectedPlaylistForAdd = playlist.id"
                                 class="p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition"
                                 :class="{'border-blue-500 bg-blue-50': selectedPlaylistForAdd === playlist.id}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium">{{ playlist.name }}</p>
                                        <p class="text-sm text-gray-600">{{ playlist.total_tracks }} È¶ñÊ≠åÊõ≤</p>
                                        <div class="flex space-x-2 mt-1">
                                            <span v-if="playlist.country" class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                                {{ playlist.country }}
                                            </span>
                                            <span v-if="playlist.category" class="text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded-full">
                                                {{ playlist.category }}
                                            </span>
                                        </div>
                                    </div>
                                    <input type="radio" 
                                           :value="playlist.id" 
                                           v-model="selectedPlaylistForAdd"
                                           class="w-4 h-4 text-blue-600">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else class="text-center text-gray-500 py-4">
                        <i class="fas fa-music text-2xl mb-2"></i>
                        <p>ËøòÊ≤°ÊúâÊ≠åÂçïÔºåÂàõÂª∫Á¨¨‰∏Ä‰∏™ÂêßÔºÅ</p>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button @click="showAddToPlaylistModal = false" 
                            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
                        ÂèñÊ∂à
                    </button>
                    <button @click="addSelectedToPlaylist" 
                            :disabled="!selectedPlaylistForAdd"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition">
                        Ê∑ªÂä†Âà∞Ê≠åÂçï
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ÂàõÂª∫Ê≠åÂçïÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showCreatePlaylistModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">ÂàõÂª∫Êñ∞Ê≠åÂçï</h3>
                    <button @click="showCreatePlaylistModal = false; showAddToPlaylistModal = true" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form @submit.prevent="createPlaylist" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê≠åÂçïÂêçÁß∞ *</label>
                        <input v-model="newPlaylistData.name" 
                               type="text" 
                               required
                               placeholder="ËæìÂÖ•Ê≠åÂçïÂêçÁß∞..."
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ÊèèËø∞</label>
                        <textarea v-model="newPlaylistData.description" 
                                  placeholder="ÊèèËø∞Ëøô‰∏™Ê≠åÂçï..."
                                  rows="2"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÂàÜÁ±ª</label>
                            <select v-model="newPlaylistData.category" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ÈÄâÊã©ÂàÜÁ±ª...</option>
                                <option v-for="cat in playlistCategories" :key="cat" :value="cat">{{ cat }}</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÂõΩÂÆ∂</label>
                            <select v-model="newPlaylistData.country" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ÈÄâÊã©ÂõΩÂÆ∂...</option>
                                <option v-for="country in countryOptions" :key="country" :value="country">{{ country }}</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ËØ≠Ë®Ä</label>
                            <select v-model="newPlaylistData.language" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ÈÄâÊã©ËØ≠Ë®Ä...</option>
                                <option v-for="lang in languageOptions" :key="lang" :value="lang">{{ lang }}</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÊÉÖÁª™</label>
                            <select v-model="newPlaylistData.mood" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ÈÄâÊã©ÊÉÖÁª™...</option>
                                <option v-for="mood in moodOptions" :key="mood" :value="mood">{{ mood }}</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Ê†áÁ≠æ</label>
                        <input v-model="newPlaylistData.tags" 
                               type="text" 
                               placeholder="ËæìÂÖ•Ê†áÁ≠æÔºåÁî®ÈÄóÂè∑ÂàÜÈöî..."
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="flex justify-end space-x-2 pt-4">
                        <button type="button" 
                                @click="showCreatePlaylistModal = false; showAddToPlaylistModal = true" 
                                class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
                            ËøîÂõû
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            ÂàõÂª∫Ê≠åÂçï
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    activeTab: 'search',
                    searchQuery: '',
                    searchLimit: 100,
                    searching: false,
                    searchResults: [],
                    searchType: null, // 'track', 'playlist', 'album'
                    selectedTracks: [], // ÈÄâ‰∏≠ÁöÑÊ≠åÊõ≤ID
                    downloadingTracks: [], // Ê≠£Âú®‰∏ãËΩΩÁöÑÊ≠åÊõ≤ID
                    streamingTracks: [], // Ê≠£Âú®Ëé∑ÂèñÊµÅÂ™í‰ΩìÈìæÊé•ÁöÑÊ≠åÊõ≤ID
                    
                    // ÊêúÁ¥¢Á≠õÈÄâÈÄâÈ°π
                    showAdvancedFilters: false,
                    searchFilters: {
                        country: '',
                        language: '',
                        deduplicate: true,
                        preview_only: false
                    },
                    
                    // ÊêúÁ¥¢‰ºòÂåñÂäüËÉΩ
                    searchCache: new Map(), // ÊêúÁ¥¢ÁªìÊûúÁºìÂ≠ò
                    searchDebounceTimer: null, // Èò≤ÊäñÂÆöÊó∂Âô®
                    searchHistory: [], // ÊêúÁ¥¢ÂéÜÂè≤
                    showSearchHistory: false, // ÊòæÁ§∫ÊêúÁ¥¢ÂéÜÂè≤
                    batchDownloading: false,
                    batchDownloadProgress: {
                        show: false,
                        total: 0,
                        completed: 0,
                        current: '',
                        failed: []
                    },
                    downloading: false,
                    downloadForm: {
                        url: '',
                        format: 'mp3',
                        quality: '320k'
                    },
                    downloadTasks: [],
                    library: [],
                    originalLibrary: [], // ÂéüÂßãÈü≥‰πêÂ∫ìÊï∞ÊçÆ
                    librarySearch: '',
                    libraryFilters: {
                        genre: '',
                        country: '',
                        language: '',
                        mood: ''
                    },
                    availableGenres: ['ÊµÅË°å', 'ÊëáÊªö', 'Âè§ÂÖ∏', 'ÁàµÂ£´', 'ÁîµÂ≠ê', 'Ê∞ëË∞£', 'ÂòªÂìà', 'R&B', '‰π°Êùë', 'ÈáëÂ±û'],
                    availableCountries: ['‰∏≠ÂõΩ', 'ÁæéÂõΩ', 'Ëã±ÂõΩ', 'Êó•Êú¨', 'Èü©ÂõΩ', 'ÂÖ∂‰ªñ'],
                    availableLanguages: ['‰∏≠Êñá', 'Ëã±Êñá', 'Êó•ËØ≠', 'Èü©ËØ≠', 'ÂÖ∂‰ªñ'],
                    availableMoods: ['Âø´‰πê', 'Âøß‰º§', 'ÊøÄÊòÇ', 'Êµ™Êº´', 'ÊîæÊùæ'],
                    currentTrack: null,
                    playing: false,
                    currentTime: 0,
                    duration: 0,
                    volume: 80,
                    previewTimer: null, // ËØïÂê¨ÂÆöÊó∂Âô®
                    systemInfo: {
                        has_ffmpeg: false
                    },
                    playSettings: {
                        previewDuration: 30, // ËØïÂê¨Êó∂ÈïøÔºàÁßíÔºâ
                        autoStop: true, // ÊòØÂê¶Ëá™Âä®ÂÅúÊ≠¢ËØïÂê¨
                        streamPreviewMode: false // ÊµÅÂ™í‰ΩìËØïÂê¨Ê®°Âºè
                    },
                    // Êî∂ËóèÂàóË°®ÂäüËÉΩ
                    favoriteLists: [], // Êî∂ËóèÂàóË°®
                    currentFavoriteList: null, // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊî∂ËóèÂàóË°®
                    showCreateListModal: false, // ÊòæÁ§∫ÂàõÂª∫ÂàóË°®Ê®°ÊÄÅÊ°Ü
                    newListName: '', // Êñ∞ÂàóË°®ÂêçÁß∞
                    
                    // Êí≠ÊîæÈòüÂàóÂäüËÉΩ
                    playQueue: [], // Êí≠ÊîæÈòüÂàó
                    currentQueueIndex: -1, // ÂΩìÂâçÊí≠ÊîæÁ¥¢Âºï
                    shuffleMode: false, // ÈöèÊú∫Êí≠ÊîæÊ®°Âºè
                    repeatMode: 'none', // ÈáçÂ§çÊ®°Âºè: none, all, single
                    
                    // Ê≠åÂçïÁÆ°ÁêÜÂäüËÉΩ
                    userPlaylists: [], // Áî®Êà∑ÂàõÂª∫ÁöÑÊ≠åÂçï
                    playlistsLoading: false, // Ê≠åÂçïÂàóË°®Âä†ËΩΩÁä∂ÊÄÅ
                    playlistSongsLoading: {}, // Ê≠åÂçïÊ≠åÊõ≤Âä†ËΩΩÁä∂ÊÄÅ
                    showAddToPlaylistModal: false, // ÊòæÁ§∫Ê∑ªÂä†Âà∞Ê≠åÂçïÁöÑÊ®°ÊÄÅÊ°Ü
                    showCreatePlaylistModal: false, // ÊòæÁ§∫ÂàõÂª∫Ê≠åÂçïÁöÑÊ®°ÊÄÅÊ°Ü
                    newPlaylistData: {
                        name: '',
                        description: '',
                        category: '',
                        country: '',
                        language: '',
                        mood: '',
                        tags: ''
                    },
                    selectedPlaylistForAdd: null, // ÈÄâ‰∏≠Ë¶ÅÊ∑ªÂä†Ê≠åÊõ≤ÁöÑÊ≠åÂçï
                    playlistCategories: [
                        'Èü©ÂõΩÊµÅË°å', 'Êó•Êú¨Âä®Êº´', 'Ê¨ßÁæéÁªèÂÖ∏', '‰∏≠ÊñáÊµÅË°å', 
                        'ÁîµÂ≠êÈü≥‰πê', 'ÊëáÊªöÈáëÂ±û', 'Ê∞ëË∞£ËΩªÈü≥‰πê', 'Âè§ÂÖ∏Èü≥‰πê'
                    ],
                    countryOptions: [
                        'Èü©ÂõΩ', 'Êó•Êú¨', '‰∏≠ÂõΩ', 'Âè∞Êπæ', 'È¶ôÊ∏Ø', 'ÁæéÂõΩ', 
                        'Ëã±ÂõΩ', 'Âæ∑ÂõΩ', 'Ê≥ïÂõΩ', 'ÂÖ∂‰ªñ'
                    ],
                    
                    // ÂõæÁâáÊáíÂä†ËΩΩÁä∂ÊÄÅÁÆ°ÁêÜ
                    imageStates: {}, // ÂõæÁâáÂä†ËΩΩÁä∂ÊÄÅ
                    defaultAlbumArt: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNjBDODkuMzkxMyA2MCA4MC44Njk2IDY4LjQyMTQgODAuODY5NiA3OC43NVY5MS44NzVDODAuODY5NiA5Mi45MTA1IDgxLjY5NTcgOTMuNzUgODIuNzE3NCA5My43NUg4NC41NjUyQzg1LjU4NyA5My43NSA4Ni40MTMgOTIuOTEwNSA4Ni40MTMgOTEuODc1Vjc4Ljc1Qzg2LjQxMyA3MS41MzI5IDkyLjQ1NjUgNjUuNjI1IDEwMCA2NS42MjVDMTA3LjU0MyA2NS42MjUgMTEzLjU4NyA3MS41MzI5IDExMy41ODcgNzguNzVWMTIxLjI1QzExMy41ODcgMTI4LjQ2NyAxMDcuNTQzIDEzNC4zNzUgMTAwIDEzNC4zNzVDOTIuNDU2NSAxMzQuMzc1IDg2LjQxMyAxMjguNDY3IDg2LjQxMyAxMjEuMjVWMTA4LjEyNUM4Ni40MTMgMTA3LjA4OSA4NS41ODcgMTA2LjI1IDg0LjU2NTIgMTA2LjI1SDgyLjcxNzRDODEuNjk1NyAxMDYuMjUgODAuODY5NiAxMDcuMDg5IDgwLjg2OTYgMTA4LjEyNVYxMjEuMjVDODAuODY5NiAxMzEuNTc5IDg5LjM5MTMgMTQwIDEwMCAxNDBDMTEwLjYwOSAxNDAgMTE5LjEzIDEzMS41NzkgMTE5LjEzIDEyMS4yNVY3OC43NUMxMTkuMTMgNjguNDIxNCAxMTAuNjA5IDYwIDEwMCA2MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI2MCIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+', // ÈªòËÆ§‰∏ìËæëÂ∞ÅÈù¢ SVG
                    imageObserver: null, // Intersection Observer ÂÆû‰æã
                    languageOptions: [
                        'Èü©ËØ≠', 'Êó•ËØ≠', '‰∏≠Êñá', 'Á≤§ËØ≠', 'Ëã±ËØ≠', 
                        'Ë•øÁè≠ÁâôËØ≠', 'Ê≥ïËØ≠', 'Âæ∑ËØ≠', 'ÂÖ∂‰ªñ'
                    ],
                    moodOptions: [
                        'Âø´‰πê', 'Âøß‰º§', 'ÊøÄÊòÇ', 'Êµ™Êº´', 'ÊîæÊùæ'
                    ]
                }
            },
            mounted() {
                this.loadSystemInfo();
                this.loadDownloadTasks();
                this.loadLibrary();
                this.loadSettings();
                this.loadFavoriteListsFromStorage();
                this.loadUserPlaylists();
                this.loadSearchHistory();
                this.startPolling();
                
                // ÂàùÂßãÂåñÂõæÁâáÊáíÂä†ËΩΩËßÇÂØüÂô®
                this.initImageObserver();
                
                // ÂÆöÊúüÊ∏ÖÁêÜËøáÊúüÁºìÂ≠ò
                setInterval(() => {
                    this.cleanExpiredCache();
                    this.cleanImageStates();
                }, 5 * 60 * 1000); // ÊØè5ÂàÜÈíüÊ∏ÖÁêÜ‰∏ÄÊ¨°
            },
            
            beforeUnmount() {
                // Ê∏ÖÁêÜ Intersection Observer
                if (this.imageObserver) {
                    this.imageObserver.disconnect();
                }
            },
            
            methods: {
                // ÂõæÁâáÊáíÂä†ËΩΩÁõ∏ÂÖ≥ÊñπÊ≥ï
                onImageLoad(imageId) {
                    this.imageStates[imageId] = { loaded: true, error: false };
                },
                
                onImageError(imageId, event) {
                    const retryCount = this.imageStates[imageId]?.retryCount || 0;
                    
                    if (retryCount < 2) {
                        // ÈáçËØïÂä†ËΩΩ
                        this.imageStates[imageId] = { 
                            loaded: false, 
                            error: false, 
                            retryCount: retryCount + 1 
                        };
                        
                        // Âª∂ËøüÈáçËØï
                        setTimeout(() => {
                            if (event && event.target) {
                                const img = event.target;
                                const originalSrc = img.src;
                                img.src = '';
                                img.src = originalSrc;
                            }
                        }, 1000 * (retryCount + 1));
                    } else {
                        // Ë∂ÖËøáÈáçËØïÊ¨°Êï∞ÔºåÊòæÁ§∫ÈîôËØØÁä∂ÊÄÅ
                        this.imageStates[imageId] = { loaded: false, error: true, retryCount };
                    }
                },
                
                resetImageState(imageId) {
                    if (this.imageStates[imageId]) {
                        delete this.imageStates[imageId];
                    }
                },
                
                // È¢ÑÂä†ËΩΩÂõæÁâá
                preloadImage(url) {
                    if (!url || url === this.defaultAlbumArt) return;
                    const img = new Image();
                    img.src = url;
                },
                
                // ÊâπÈáèÈ¢ÑÂä†ËΩΩÂõæÁâá
                preloadImages(items, keyPath = 'album_art') {
                    if (!items || !Array.isArray(items)) return;
                    items.forEach(item => {
                        const url = keyPath.split('.').reduce((obj, key) => obj?.[key], item);
                        if (url) this.preloadImage(url);
                    });
                },
                
                // ÂàùÂßãÂåñÂõæÁâáËßÇÂØüÂô®
                initImageObserver() {
                    if ('IntersectionObserver' in window) {
                        this.imageObserver = new IntersectionObserver(
                            (entries) => {
                                entries.forEach(entry => {
                                    if (entry.isIntersecting) {
                                        const img = entry.target;
                                        const src = img.dataset.src;
                                        if (src && !img.src) {
                                            img.src = src;
                                            this.imageObserver.unobserve(img);
                                        }
                                    }
                                });
                            },
                            {
                                rootMargin: '50px 0px',
                                threshold: 0.01
                            }
                        );
                    }
                },
                
                // ËßÇÂØüÂõæÁâáÂÖÉÁ¥†
                observeImage(element) {
                    if (this.imageObserver && element) {
                        this.imageObserver.observe(element);
                    }
                },
                
                // Ê∏ÖÁêÜÂõæÁâáÁä∂ÊÄÅÁºìÂ≠ò
                cleanImageStates() {
                    const maxStates = 200; // ÊúÄÂ§ö‰øùÁïô200‰∏™ÂõæÁâáÁä∂ÊÄÅ
                    const keys = Object.keys(this.imageStates);
                    
                    if (keys.length > maxStates) {
                        // Âà†Èô§ÊúÄÊó©ÁöÑÁä∂ÊÄÅ
                        const toRemove = keys.slice(0, keys.length - maxStates);
                        toRemove.forEach(key => {
                            delete this.imageStates[key];
                        });
                    }
                },
                
                // ‰ºòÂåñÁâàÊú¨ÁöÑ searchMusic ÂáΩÊï∞ÔºåÂåÖÂê´Èò≤Êäñ„ÄÅÁºìÂ≠òÂíåÊêúÁ¥¢ÂéÜÂè≤
                async searchMusic() {
                    if (!this.searchQuery) return;
                    
                    // Ê£ÄÊü•ÁºìÂ≠ò
                    const cacheKey = `search_${this.searchQuery}_${this.searchLimit}`;
                    const cached = this.searchCache.get(cacheKey);
                    if (cached) {
                        this.searchResults = cached.results;
                        this.searchType = cached.type;
                        this.selectedTracks = [];
                        return;
                    }
                    
                    this.searching = true;
                    this.searchResults = [];
                    this.selectedTracks = [];
                    this.searchType = null;
                    
                    try {
                        let results, type;
                        
                        // Â¶ÇÊûúÊòØ Spotify ÈìæÊé•ÔºåÁõ¥Êé•Ëß£Êûê
                        if (this.searchQuery.includes('spotify.com')) {
                            const response = await axios.post('/api/spotify/parse', {
                                url: this.searchQuery
                            });
                            
                            const result = response.data;
                            type = result.type;
                            
                            if (result.type === 'track') {
                                results = [result.data];
                            } else if (result.type === 'playlist' || result.type === 'album') {
                                results = result.tracks;
                                // ÊòæÁ§∫Êí≠ÊîæÂàóË°®/‰∏ìËæë‰ø°ÊÅØ
                                if (result.type === 'playlist') {
                                    this.$nextTick(() => {
                                        alert(`ÊâæÂà∞Êí≠ÊîæÂàóË°®: ${result.name}\nÂåÖÂê´ ${result.total_tracks} È¶ñÊ≠åÊõ≤\nÂèØ‰ΩøÁî®ÊâπÈáè‰∏ãËΩΩÂäüËÉΩ`);
                                    });
                                } else {
                                    this.$nextTick(() => {
                                        alert(`ÊâæÂà∞‰∏ìËæë: ${result.name}\nËâ∫ÊúØÂÆ∂: ${result.artist}\nÂåÖÂê´ ${result.total_tracks} È¶ñÊ≠åÊõ≤\nÂèØ‰ΩøÁî®ÊâπÈáè‰∏ãËΩΩÂäüËÉΩ`);
                                    });
                                }
                            }
                        } else {
                            // Âê¶ÂàôÊêúÁ¥¢Ê≠åÊõ≤
                            type = 'search';
                            const response = await axios.get('/api/spotify/search', {
                                params: { 
                                    q: this.searchQuery,
                                    limit: this.searchLimit,
                                    country_filter: this.searchFilters.country || null,
                                    language_filter: this.searchFilters.language || null,
                                    deduplicate: this.searchFilters.deduplicate,
                                    preview_only: this.searchFilters.preview_only
                                }
                            });
                            results = response.data.tracks || [];
                        }
                        
                        // ‰øùÂ≠òÊêúÁ¥¢ÁªìÊûú
                        this.searchResults = results;
                        this.searchType = type;
                        
                        // ÁºìÂ≠òÁªìÊûú
                        this.searchCache.set(cacheKey, {
                            results: results,
                            type: type,
                            timestamp: Date.now()
                        });
                        
                        // Ê∑ªÂä†Âà∞ÊêúÁ¥¢ÂéÜÂè≤
                        this.addToSearchHistory(this.searchQuery);
                        
                    } catch (error) {
                        alert('ÊêúÁ¥¢Â§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        this.searching = false;
                    }
                },
                
                async searchCountryTop(country) {
                    this.searching = true;
                    this.searchResults = [];
                    this.selectedTracks = [];
                    this.searchType = 'country-top';
                    
                    try {
                        const response = await axios.get('/api/spotify/country-top', {
                            params: { 
                                country: country,
                                limit: this.searchLimit
                            }
                        });
                        
                        this.searchResults = response.data.tracks || [];
                        
                        // È¢ÑÂä†ËΩΩÊêúÁ¥¢ÁªìÊûú‰∏≠ÁöÑÂõæÁâá
                        this.preloadImages(this.searchResults.slice(0, 20), 'album_art');
                        
                        // ÊòæÁ§∫ÊêúÁ¥¢‰ø°ÊÅØ
                        const countryNames = {
                            'korea': 'Èü©ÂõΩ',
                            'japan': 'Êó•Êú¨',
                            'turkey': 'ÂúüËÄ≥ÂÖ∂',
                            'usa': 'Ê¨ßÁæé',
                            'uk': 'Ëã±ÂõΩ',
                            'china': 'ÂçéËØ≠',
                            'taiwan': 'Âè∞Êπæ',
                            'europe': 'Ê¨ßÊ¥≤'
                        };
                        
                        const countryName = countryNames[country] || country;
                        this.searchQuery = `${countryName}ÁÉ≠Èó®Èü≥‰πê`;
                        
                        console.log(`ÊâæÂà∞ ${this.searchResults.length} È¶ñ${countryName}ÁÉ≠Èó®Ê≠åÊõ≤`);
                        
                    } catch (error) {
                        alert('Ëé∑ÂèñÁÉ≠Èó®Èü≥‰πêÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        this.searching = false;
                    }
                },
                
                async downloadTrack(track) {
                    // Ê∑ªÂä†Âà∞‰∏ãËΩΩ‰∏≠ÂàóË°®
                    this.downloadingTracks.push(track.id);
                    
                    try {
                        const response = await axios.post('/api/download', {
                            url: track.spotify_url || track.url,
                            format: this.downloadForm.format,
                            quality: this.downloadForm.quality,
                            metadata: {
                                title: track.title,
                                artist: track.artist,
                                album: track.album,
                                album_art: track.album_art,
                                preview_url: track.preview_url,
                                duration: track.duration,
                                year: track.year,
                                country: track.country,
                                language: track.language,
                                spotify_id: track.id,
                                spotify_url: track.spotify_url || track.url
                            }
                        });
                        
                        // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                        this.$nextTick(() => {
                            alert('‰∏ãËΩΩ‰ªªÂä°Â∑≤ÂàõÂª∫ÔºÅ');
                        });
                        this.loadDownloadTasks();
                    } catch (error) {
                        alert('‰∏ãËΩΩÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        // ‰ªé‰∏ãËΩΩ‰∏≠ÂàóË°®ÁßªÈô§
                        const index = this.downloadingTracks.indexOf(track.id);
                        if (index > -1) {
                            this.downloadingTracks.splice(index, 1);
                        }
                    }
                },
                
                async startDownload() {
                    if (!this.downloadForm.url) {
                        alert('ËØ∑ËæìÂÖ•‰∏ãËΩΩÈìæÊé•');
                        return;
                    }
                    
                    this.downloading = true;
                    try {
                        const response = await axios.post('/api/download', this.downloadForm);
                        alert('‰∏ãËΩΩ‰ªªÂä°Â∑≤ÂàõÂª∫ÔºÅ');
                        this.downloadForm.url = '';
                        this.loadDownloadTasks();
                    } catch (error) {
                        alert('‰∏ãËΩΩÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    } finally {
                        this.downloading = false;
                    }
                },
                
                async loadDownloadTasks() {
                    try {
                        const response = await axios.get('/api/tasks?per_page=20');
                        this.downloadTasks = response.data.items || [];
                    } catch (error) {
                        console.error('Failed to load tasks:', error);
                    }
                },
                
                async loadLibrary() {
                    try {
                        const response = await axios.get('/api/songs?per_page=50');
                        this.originalLibrary = response.data.items || [];
                        this.library = [...this.originalLibrary];
                        
                        // È¢ÑÂä†ËΩΩÈü≥‰πêÂ∫ì‰∏≠ÁöÑÂõæÁâá
                        this.preloadImages(this.library.slice(0, 20), 'album_art_url');
                        
                        // ÁîüÊàêÂèØÁî®ÁöÑÁ≠õÈÄâÈÄâÈ°π
                        this.generateFilterOptions();
                        this.filterLibrary();
                        
                        console.log('Èü≥‰πêÂ∫ìÂä†ËΩΩÂÆåÊàê:', this.originalLibrary.length, 'È¶ñÊ≠åÊõ≤');
                    } catch (error) {
                        console.error('Failed to load library:', error);
                    }
                },
                
                generateFilterOptions() {
                    // ‰ªéÁé∞ÊúâÊï∞ÊçÆÁîüÊàêÁ≠õÈÄâÈÄâÈ°π
                    const genres = new Set();
                    const countries = new Set();
                    const languages = new Set();
                    const moods = new Set();
                    
                    this.originalLibrary.forEach(song => {
                        if (song.genre) genres.add(song.genre);
                        if (song.country) countries.add(song.country);
                        if (song.language) languages.add(song.language);
                        if (song.mood) moods.add(song.mood);
                    });
                    
                    // Êõ¥Êñ∞ÂèØÁî®ÈÄâÈ°πÔºå‰ΩÜ‰øùÁïôÈªòËÆ§ÈÄâÈ°π
                    this.availableGenres = [...this.availableGenres, ...Array.from(genres)];
                    this.availableCountries = Array.from(countries);
                    this.availableLanguages = Array.from(languages);
                    this.availableMoods = Array.from(moods);
                    
                    console.log('Á≠õÈÄâÈÄâÈ°π:', {
                        genres: this.availableGenres.length,
                        countries: this.availableCountries.length,
                        languages: this.availableLanguages.length,
                        moods: this.availableMoods.length
                    });
                },
                
                filterLibrary() {
                    let filtered = [...this.originalLibrary];
                    console.log('ÂºÄÂßãÁ≠õÈÄâÔºåÂéüÂßãÊï∞ÊçÆ:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    
                    // ÊñáÊú¨ÊêúÁ¥¢
                    if (this.librarySearch && this.librarySearch.trim()) {
                        const search = this.librarySearch.toLowerCase().trim();
                        filtered = filtered.filter(song => 
                            song.title?.toLowerCase().includes(search) ||
                            song.artist?.toLowerCase().includes(search) ||
                            song.album?.toLowerCase().includes(search)
                        );
                        console.log('ÊñáÊú¨ÊêúÁ¥¢Âêé:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    }
                    
                    // ÊµÅÊ¥æËøáÊª§
                    if (this.libraryFilters.genre) {
                        filtered = filtered.filter(song => song.genre === this.libraryFilters.genre);
                        console.log('ÊµÅÊ¥æÁ≠õÈÄâÂêé:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    }
                    
                    // ÂõΩÂÆ∂ËøáÊª§
                    if (this.libraryFilters.country) {
                        filtered = filtered.filter(song => song.country === this.libraryFilters.country);
                        console.log('ÂõΩÂÆ∂Á≠õÈÄâÂêé:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    }
                    
                    // ËØ≠Ë®ÄËøáÊª§
                    if (this.libraryFilters.language) {
                        filtered = filtered.filter(song => song.language === this.libraryFilters.language);
                        console.log('ËØ≠Ë®ÄÁ≠õÈÄâÂêé:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    }
                    
                    // ÊÉÖÁª™ËøáÊª§
                    if (this.libraryFilters.mood) {
                        filtered = filtered.filter(song => song.mood === this.libraryFilters.mood);
                        console.log('ÊÉÖÁª™Á≠õÈÄâÂêé:', filtered.length, 'È¶ñÊ≠åÊõ≤');
                    }
                    
                    this.library = filtered;
                    console.log('ÊúÄÁªàÁ≠õÈÄâÁªìÊûú:', this.library.length, 'È¶ñÊ≠åÊõ≤');
                },
                
                async loadSystemInfo() {
                    try {
                        const response = await axios.get('/api/system-info');
                        this.systemInfo = response.data;
                    } catch (error) {
                        console.error('Failed to load system info:', error);
                    }
                },
                
                playPreview(track) {
                    if (!track.preview_url) return;
                    
                    // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                    if (this.previewTimer) {
                        clearTimeout(this.previewTimer);
                        this.previewTimer = null;
                    }
                    
                    this.currentTrack = {
                        ...track,
                        playType: 'preview' // Ê†áËÆ∞‰∏∫ËØïÂê¨Ê®°Âºè
                    };
                    this.$refs.audioPlayer.src = track.preview_url;
                    this.$refs.audioPlayer.play();
                    this.playing = true;
                    
                    console.log('üéµ ÂºÄÂßãËØïÂê¨Êí≠Êîæ:', track.title);
                },
                
                async playDirectStream(track) {
                    // Ê∑ªÂä†Âà∞ÊµÅÂ™í‰ΩìËé∑Âèñ‰∏≠ÂàóË°®
                    this.streamingTracks.push(track.id);
                    
                    try {
                        const query = `${track.artist} ${track.title}`;
                        const response = await axios.post('/api/get-stream-url', {
                            query: query
                        });
                        
                        if (response.data.success) {
                            // ËÆæÁΩÆÂΩìÂâçÊí≠ÊîæËΩ®ÈÅì
                            this.currentTrack = {
                                ...track,
                                stream_url: response.data.stream_url,
                                playType: 'stream' // Ê†áËÆ∞‰∏∫ÊµÅÂ™í‰ΩìÊí≠Êîæ
                            };
                            
                            // Êí≠ÊîæÊµÅÂ™í‰Ωì
                            this.$refs.audioPlayer.src = response.data.stream_url;
                            this.$refs.audioPlayer.play();
                            this.playing = true;
                            
                            // Â¶ÇÊûúÂêØÁî®‰∫ÜÊµÅÂ™í‰ΩìËØïÂê¨Ê®°ÂºèÔºåËÆæÁΩÆËá™Âä®ÂÅúÊ≠¢
                            if (this.playSettings.streamPreviewMode && this.playSettings.autoStop) {
                                // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                                if (this.previewTimer) {
                                    clearTimeout(this.previewTimer);
                                }
                                
                                // ËÆæÁΩÆÊñ∞ÁöÑÂÆöÊó∂Âô®
                                this.previewTimer = setTimeout(() => {
                                    if (this.currentTrack && this.currentTrack.playType === 'stream') {
                                        this.$refs.audioPlayer.pause();
                                        this.playing = false;
                                        console.log(`üîï ÊµÅÂ™í‰ΩìËØïÂê¨ÁªìÊùü (${this.playSettings.previewDuration}Áßí):`, track.title);
                                    }
                                }, this.playSettings.previewDuration * 1000);
                                
                                console.log(`üéµ ÂºÄÂßãÊµÅÂ™í‰ΩìËØïÂê¨Êí≠Êîæ (${this.playSettings.previewDuration}Áßí):`, track.title);
                            } else {
                                console.log('üéµ ÂºÄÂßãÊµÅÂ™í‰ΩìÊí≠Êîæ:', track.title);
                            }
                        } else {
                            alert('Ëé∑ÂèñÊí≠ÊîæÈìæÊé•Â§±Ë¥•: ' + response.data.error);
                        }
                    } catch (error) {
                        alert('Êí≠ÊîæÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                        console.error('Stream play error:', error);
                    } finally {
                        // ‰ªéÊµÅÂ™í‰ΩìËé∑Âèñ‰∏≠ÂàóË°®ÁßªÈô§
                        const index = this.streamingTracks.indexOf(track.id);
                        if (index > -1) {
                            this.streamingTracks.splice(index, 1);
                        }
                    }
                },
                
                playSong(song) {
                    if (!song.file_path) {
                        alert('Ê≠åÊõ≤Êñá‰ª∂‰∏çÂ≠òÂú®ÔºåËØ∑ÂÖà‰∏ãËΩΩ');
                        return;
                    }
                    
                    // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                    if (this.previewTimer) {
                        clearTimeout(this.previewTimer);
                        this.previewTimer = null;
                    }
                    
                    this.currentTrack = {
                        ...song,
                        playType: 'local' // Ê†áËÆ∞‰∏∫Êú¨Âú∞Êñá‰ª∂Êí≠Êîæ
                    };
                    this.$refs.audioPlayer.src = `/api/stream/${song.id}`;
                    this.$refs.audioPlayer.play();
                    this.playing = true;
                    
                    console.log('üéµ ÂºÄÂßãÊú¨Âú∞Êñá‰ª∂Êí≠Êîæ:', song.title);
                },
                
                togglePlay() {
                    if (this.playing) {
                        this.$refs.audioPlayer.pause();
                        // Ê∏ÖÈô§ËØïÂê¨ÂÆöÊó∂Âô®
                        if (this.previewTimer) {
                            clearTimeout(this.previewTimer);
                            this.previewTimer = null;
                        }
                    } else {
                        this.$refs.audioPlayer.play();
                    }
                    this.playing = !this.playing;
                },
                
                previousTrack() {
                    // Â¶ÇÊûúÊúâÊí≠ÊîæÈòüÂàó
                    if (this.playQueue.length > 0) {
                        let newIndex = this.currentQueueIndex - 1;
                        
                        // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÈ¶ñÔºåÊ†πÊçÆÈáçÂ§çÊ®°ÂºèÂ§ÑÁêÜ
                        if (newIndex < 0) {
                            if (this.repeatMode === 'all') {
                                newIndex = this.playQueue.length - 1;
                            } else {
                                return; // ÂÅúÊ≠¢
                            }
                        }
                        
                        this.playFromQueue(newIndex);
                    }
                },
                
                nextTrack() {
                    // Â¶ÇÊûúÊúâÊí≠ÊîæÈòüÂàó
                    if (this.playQueue.length > 0) {
                        // ÂçïÊõ≤Âæ™ÁéØÊ®°ÂºèÔºöÈáçÂ§çÊí≠ÊîæÂΩìÂâçÊ≠åÊõ≤
                        if (this.repeatMode === 'single') {
                            this.playFromQueue(this.currentQueueIndex);
                            return;
                        }
                        
                        let newIndex = this.currentQueueIndex + 1;
                        
                        // Â¶ÇÊûúÊòØÊúÄÂêé‰∏ÄÈ¶ñÔºåÊ†πÊçÆÈáçÂ§çÊ®°ÂºèÂ§ÑÁêÜ
                        if (newIndex >= this.playQueue.length) {
                            if (this.repeatMode === 'all') {
                                newIndex = 0;
                            } else if (this.shuffleMode) {
                                // ÈöèÊú∫Ê®°Âºè‰∏ãÈáçÊñ∞Êâì‰π±
                                this.playQueue = this.shuffleArray(this.playQueue);
                                newIndex = 0;
                            } else {
                                // Êí≠ÊîæÁªìÊùü
                                this.playQueue = [];
                                this.currentQueueIndex = -1;
                                return;
                            }
                        }
                        
                        this.playFromQueue(newIndex);
                    }
                },
                
                seekTo(event) {
                    this.$refs.audioPlayer.currentTime = event.target.value;
                },
                
                changeVolume(event) {
                    this.$refs.audioPlayer.volume = event.target.value / 100;
                },
                
                updateTime() {
                    this.currentTime = this.$refs.audioPlayer.currentTime;
                },
                
                onLoadedMetadata() {
                    this.duration = this.$refs.audioPlayer.duration;
                },
                
                onEnded() {
                    this.playing = false;
                    this.nextTrack();
                },
                
                formatTime(seconds) {
                    if (!seconds) return '0:00';
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                },
                
                getStatusColor(status) {
                    const colors = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'processing': 'bg-blue-100 text-blue-800',
                        'downloading': 'bg-blue-100 text-blue-800',
                        'completed': 'bg-green-100 text-green-800',
                        'failed': 'bg-red-100 text-red-800'
                    };
                    return colors[status] || 'bg-gray-100 text-gray-800';
                },
                
                getStatusText(status) {
                    const texts = {
                        'pending': 'Á≠âÂæÖ‰∏≠',
                        'processing': 'Â§ÑÁêÜ‰∏≠',
                        'downloading': '‰∏ãËΩΩ‰∏≠',
                        'completed': 'Â∑≤ÂÆåÊàê',
                        'failed': 'Â§±Ë¥•'
                    };
                    return texts[status] || status;
                },
                
                formatDate(dateString) {
                    if (!dateString) return '-';
                    return new Date(dateString).toLocaleString('zh-CN');
                },
                
                formatDuration(seconds) {
                    if (!seconds) return '';
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                },
                
                selectAllTracks() {
                    if (this.selectedTracks.length === this.searchResults.length) {
                        // Â¶ÇÊûúÂ∑≤ÂÖ®ÈÄâÔºåÂàôÂèñÊ∂àÂÖ®ÈÄâ
                        this.selectedTracks = [];
                    } else {
                        // Âê¶ÂàôÂÖ®ÈÄâ
                        this.selectedTracks = this.searchResults.map(track => track.id);
                    }
                },
                
                async downloadSelectedTracks() {
                    if (this.selectedTracks.length === 0) {
                        alert('ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰∏ãËΩΩÁöÑÊ≠åÊõ≤');
                        return;
                    }
                    
                    this.batchDownloading = true;
                    this.batchDownloadProgress = {
                        show: true,
                        total: this.selectedTracks.length,
                        completed: 0,
                        current: '',
                        failed: []
                    };
                    
                    for (const trackId of this.selectedTracks) {
                        const track = this.searchResults.find(t => t.id === trackId);
                        if (!track) continue;
                        
                        this.batchDownloadProgress.current = `${track.artist} - ${track.title}`;
                        
                        try {
                            await axios.post('/api/download', {
                                url: track.spotify_url || track.url,
                                format: this.downloadForm.format,
                                quality: this.downloadForm.quality,
                                metadata: {
                                    title: track.title,
                                    artist: track.artist,
                                    album: track.album,
                                    album_art: track.album_art
                                }
                            });
                            
                            this.batchDownloadProgress.completed++;
                        } catch (error) {
                            this.batchDownloadProgress.failed.push({
                                track: `${track.artist} - ${track.title}`,
                                error: error.response?.data?.detail || error.message
                            });
                            this.batchDownloadProgress.completed++;
                        }
                        
                        // Áü≠ÊöÇÂª∂Ëøü‰ª•ÈÅøÂÖçËøáÂø´ËØ∑Ê±Ç
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    this.batchDownloading = false;
                    this.batchDownloadProgress.current = '';
                    
                    // ÊòæÁ§∫ÂÆåÊàêÊ∂àÊÅØ
                    const successCount = this.batchDownloadProgress.completed - this.batchDownloadProgress.failed.length;
                    const failedCount = this.batchDownloadProgress.failed.length;
                    
                    let message = `ÊâπÈáè‰∏ãËΩΩÂÆåÊàêÔºÅ\nÊàêÂäü: ${successCount} È¶ñ`;
                    if (failedCount > 0) {
                        message += `\nÂ§±Ë¥•: ${failedCount} È¶ñ`;
                    }
                    alert(message);
                    
                    this.loadDownloadTasks();
                    
                    // 5ÁßíÂêéÈöêËóèËøõÂ∫¶Êù°
                    setTimeout(() => {
                        this.batchDownloadProgress.show = false;
                    }, 5000);
                },
                
                getShortFilename(filePath) {
                    if (!filePath) return 'Êó†Êñá‰ª∂';
                    const filename = filePath.split('/').pop() || filePath.split('\\').pop();
                    return filename || 'Êó†Êñá‰ª∂';
                },
                
                getFileFormat(filePath) {
                    if (!filePath) return null;
                    const ext = filePath.split('.').pop()?.toLowerCase();
                    const formatMap = {
                        'mp3': 'MP3',
                        'webm': 'WebM',
                        'm4a': 'M4A',
                        'opus': 'Opus',
                        'aac': 'AAC',
                        'mp4': 'MP4',
                        'flac': 'FLAC'
                    };
                    return formatMap[ext] || ext?.toUpperCase();
                },
                
                getFormatColor(format) {
                    const colors = {
                        'MP3': 'bg-green-100 text-green-800',
                        'WebM': 'bg-blue-100 text-blue-800',
                        'M4A': 'bg-purple-100 text-purple-800',
                        'Opus': 'bg-indigo-100 text-indigo-800',
                        'AAC': 'bg-yellow-100 text-yellow-800',
                        'FLAC': 'bg-pink-100 text-pink-800',
                        'MP4': 'bg-orange-100 text-orange-800'
                    };
                    return colors[format] || 'bg-gray-100 text-gray-800';
                },
                
                formatFileSize(bytes) {
                    if (!bytes) return 'Êú™Áü•';
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(1024));
                    return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
                },
                
                getPlayModeText() {
                    if (!this.currentTrack) return '';
                    switch(this.currentTrack.playType) {
                        case 'stream': return 'Áõ¥Êí≠ÊµÅÂ™í‰Ωì';
                        case 'local': return 'Êú¨Âú∞Êñá‰ª∂';
                        case 'preview': return 'Spotify ËØïÂê¨';
                        default: return 'Êú™Áü•Ê®°Âºè';
                    }
                },
                
                getPlayModeIcon() {
                    if (!this.currentTrack) return '';
                    switch(this.currentTrack.playType) {
                        case 'stream': return 'fas fa-wifi';
                        case 'local': return 'fas fa-hdd';
                        case 'preview': return 'fas fa-headphones';
                        default: return 'fas fa-question';
                    }
                },
                
                getPlayModeColor() {
                    if (!this.currentTrack) return '';
                    switch(this.currentTrack.playType) {
                        case 'stream': return 'text-purple-600';
                        case 'local': return 'text-green-600';
                        case 'preview': return 'text-blue-600';
                        default: return 'text-gray-600';
                    }
                },
                
                getTaskTitle(task) {
                    return task.metadata?.title || task.title || 'Êú™Áü•Ê≠åÊõ≤';
                },
                
                getTaskArtist(task) {
                    return task.metadata?.artist || task.artist || 'Êú™Áü•Ëâ∫ÊúØÂÆ∂';
                },
                
                getTaskAlbum(task) {
                    return task.metadata?.album || task.album || 'Êú™Áü•‰∏ìËæë';
                },
                
                async deleteSong(song) {
                    if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÈ¶ñÊ≠åÂêóÔºü')) return;
                    
                    try {
                        await axios.delete(`/api/songs/${song.id}`);
                        this.loadLibrary();
                    } catch (error) {
                        alert('Âà†Èô§Â§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                // Êî∂ËóèÂàóË°®Áõ∏ÂÖ≥ÊñπÊ≥ï
                addToFavorites(track) {
                    if (this.favoriteLists.length === 0) {
                        // Â¶ÇÊûúÊ≤°ÊúâÊî∂ËóèÂàóË°®ÔºåÂàõÂª∫ÈªòËÆ§ÂàóË°®
                        this.createDefaultFavoriteList();
                    }
                    
                    // ÊòæÁ§∫ÈÄâÊã©ÂàóË°®ÁöÑÂºπÁ™ó
                    this.showFavoriteListSelector(track);
                },
                
                createDefaultFavoriteList() {
                    const defaultList = {
                        id: 'default',
                        name: 'ÊàëÁöÑÊî∂Ëóè',
                        tracks: [],
                        created_at: new Date().toISOString()
                    };
                    this.favoriteLists.push(defaultList);
                    this.saveFavoriteListsToStorage();
                },
                
                showFavoriteListSelector(track) {
                    // ÁÆÄÂçïÂÆûÁé∞ÔºöÁõ¥Êé•Âä†ÂÖ•Âà∞Á¨¨‰∏Ä‰∏™ÂàóË°®
                    if (this.favoriteLists.length > 0) {
                        this.addTrackToList(track, this.favoriteLists[0]);
                    }
                },
                
                addTrackToList(track, list) {
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
                    const exists = list.tracks.some(t => t.id === track.id);
                    if (exists) {
                        alert(`"${track.title}" Â∑≤Âú®Êî∂ËóèÂàóË°® "${list.name}" ‰∏≠`);
                        return;
                    }
                    
                    // Ê∑ªÂä†Âà∞ÂàóË°®
                    list.tracks.push({
                        id: track.id,
                        title: track.title,
                        artist: track.artist,
                        album: track.album,
                        album_art: track.album_art,
                        preview_url: track.preview_url,
                        spotify_url: track.spotify_url || track.url,
                        duration: track.duration,
                        added_at: new Date().toISOString()
                    });
                    
                    this.saveFavoriteListsToStorage();
                    alert(`"${track.title}" Â∑≤Ê∑ªÂä†Âà∞Êî∂ËóèÂàóË°® "${list.name}"`);
                },
                
                createNewFavoriteList() {
                    if (!this.newListName.trim()) {
                        alert('ËØ∑ËæìÂÖ•ÂàóË°®ÂêçÁß∞');
                        return;
                    }
                    
                    const newList = {
                        id: Date.now().toString(),
                        name: this.newListName.trim(),
                        tracks: [],
                        created_at: new Date().toISOString()
                    };
                    
                    this.favoriteLists.push(newList);
                    this.saveFavoriteListsToStorage();
                    this.newListName = '';
                    this.showCreateListModal = false;
                    
                    alert(`Êî∂ËóèÂàóË°® "${newList.name}" ÂàõÂª∫ÊàêÂäü`);
                },
                
                deleteFavoriteList(list) {
                    if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Êî∂ËóèÂàóË°® "${list.name}" ÂêóÔºü`)) return;
                    
                    const index = this.favoriteLists.findIndex(l => l.id === list.id);
                    if (index > -1) {
                        this.favoriteLists.splice(index, 1);
                        this.saveFavoriteListsToStorage();
                        if (this.currentFavoriteList && this.currentFavoriteList.id === list.id) {
                            this.currentFavoriteList = null;
                        }
                    }
                },
                
                removeTrackFromList(track, list) {
                    if (!confirm(`Á°ÆÂÆöË¶Å‰ªé "${list.name}" ‰∏≠ÁßªÈô§ "${track.title}" ÂêóÔºü`)) return;
                    
                    const index = list.tracks.findIndex(t => t.id === track.id);
                    if (index > -1) {
                        list.tracks.splice(index, 1);
                        this.saveFavoriteListsToStorage();
                    }
                },
                
                saveFavoriteListsToStorage() {
                    localStorage.setItem('favoriteLists', JSON.stringify(this.favoriteLists));
                },
                
                loadFavoriteListsFromStorage() {
                    const saved = localStorage.getItem('favoriteLists');
                    if (saved) {
                        this.favoriteLists = JSON.parse(saved);
                    }
                },
                
                addSongToFavorites(song) {
                    // Â∞ÜÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊ≠åÊõ≤ËΩ¨Êç¢‰∏∫Êî∂ËóèÊ†ºÂºè
                    const track = {
                        id: song.spotify_id || song.id,
                        title: song.title,
                        artist: song.artist,
                        album: song.album,
                        album_art: song.album_art_url,
                        preview_url: song.preview_url,
                        spotify_url: song.spotify_url,
                        duration: song.duration
                    };
                    
                    this.addToFavorites(track);
                },
                
                async clearDownloadTasks(status = null) {
                    const statusText = status === 'failed' ? 'Â§±Ë¥•' : (status === 'completed' ? 'ÊàêÂäü' : 'ÊâÄÊúâ');
                    if (!confirm(`Á°ÆÂÆöË¶ÅÊ∏ÖÈô§${statusText}ÁöÑ‰∏ãËΩΩËÆ∞ÂΩïÂêóÔºü`)) return;
                    
                    try {
                        const url = status ? `/api/tasks/clear?status=${status}` : '/api/tasks/clear';
                        const response = await axios.delete(url);
                        
                        if (response.data.success) {
                            alert(response.data.message);
                            this.loadDownloadTasks(); // Âà∑Êñ∞ÂàóË°®
                        } else {
                            alert('Ê∏ÖÈô§Â§±Ë¥•');
                        }
                    } catch (error) {
                        alert('Ê∏ÖÈô§Â§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                // Êí≠ÊîæÈòüÂàóÁõ∏ÂÖ≥ÊñπÊ≥ï
                playAllInList(list) {
                    if (list.tracks.length === 0) {
                        alert('Êí≠ÊîæÂàóË°®‰∏∫Á©∫');
                        return;
                    }
                    
                    // ËÆæÁΩÆÊí≠ÊîæÈòüÂàó
                    this.playQueue = [...list.tracks];
                    this.currentQueueIndex = 0;
                    this.shuffleMode = false;
                    
                    // Êí≠ÊîæÁ¨¨‰∏ÄÈ¶ñ
                    this.playFromQueue(0);
                    
                    console.log(`ÂºÄÂßãÊí≠ÊîæÂàóË°® "${list.name}"ÔºåÂÖ± ${list.tracks.length} È¶ñÊ≠åÊõ≤`);
                },
                
                shufflePlayList(list) {
                    if (list.tracks.length === 0) {
                        alert('Êí≠ÊîæÂàóË°®‰∏∫Á©∫');
                        return;
                    }
                    
                    // Êâì‰π±ÈòüÂàó
                    this.playQueue = this.shuffleArray([...list.tracks]);
                    this.currentQueueIndex = 0;
                    this.shuffleMode = true;
                    
                    // Êí≠ÊîæÁ¨¨‰∏ÄÈ¶ñ
                    this.playFromQueue(0);
                    
                    console.log(`ÂºÄÂßãÈöèÊú∫Êí≠ÊîæÂàóË°® "${list.name}"ÔºåÂÖ± ${list.tracks.length} È¶ñÊ≠åÊõ≤`);
                },
                
                async downloadAllInList(list) {
                    if (list.tracks.length === 0) {
                        alert('Êí≠ÊîæÂàóË°®‰∏∫Á©∫');
                        return;
                    }
                    
                    if (!confirm(`Á°ÆÂÆöË¶Å‰∏ãËΩΩÂàóË°® "${list.name}" ‰∏≠ÁöÑÊâÄÊúâ ${list.tracks.length} È¶ñÊ≠åÊõ≤ÂêóÔºü`)) {
                        return;
                    }
                    
                    // ÊâπÈáè‰∏ãËΩΩÈÄªËæëÔºàÁ±ª‰ººÊâπÈáè‰∏ãËΩΩÊêúÁ¥¢ÁªìÊûúÔºâ
                    this.batchDownloading = true;
                    this.batchDownloadProgress = {
                        show: true,
                        total: list.tracks.length,
                        completed: 0,
                        current: '',
                        failed: []
                    };
                    
                    for (const track of list.tracks) {
                        this.batchDownloadProgress.current = `${track.artist} - ${track.title}`;
                        
                        try {
                            await axios.post('/api/download', {
                                url: track.spotify_url,
                                format: this.downloadForm.format,
                                quality: this.downloadForm.quality,
                                metadata: {
                                    title: track.title,
                                    artist: track.artist,
                                    album: track.album,
                                    album_art: track.album_art
                                }
                            });
                            
                            this.batchDownloadProgress.completed++;
                        } catch (error) {
                            this.batchDownloadProgress.failed.push(track.title);
                            console.error(`‰∏ãËΩΩÂ§±Ë¥•: ${track.title}`, error);
                        }
                    }
                    
                    this.batchDownloading = false;
                    
                    // ÊòæÁ§∫ÁªìÊûú
                    const message = `‰∏ãËΩΩÂÆåÊàêÔºÅÊàêÂäü: ${this.batchDownloadProgress.completed}/${this.batchDownloadProgress.total}`;
                    if (this.batchDownloadProgress.failed.length > 0) {
                        alert(message + `\nÂ§±Ë¥•: ${this.batchDownloadProgress.failed.join(', ')}`);
                    } else {
                        alert(message);
                    }
                    
                    // Âà∑Êñ∞‰∏ãËΩΩ‰ªªÂä°ÂàóË°®
                    this.loadDownloadTasks();
                },
                
                playFromQueue(index) {
                    if (index < 0 || index >= this.playQueue.length) {
                        return;
                    }
                    
                    this.currentQueueIndex = index;
                    const track = this.playQueue[index];
                    
                    // ‰ºòÂÖàÂ∞ùËØïËØïÂê¨
                    if (track.preview_url) {
                        this.playPreview(track);
                    } else {
                        // Â∞ùËØïÊµÅÂ™í‰ΩìÊí≠Êîæ
                        this.playDirectStream(track);
                    }
                },
                
                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                },
                
                startPolling() {
                    // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°‰∏ãËΩΩ‰ªªÂä°Áä∂ÊÄÅ
                    setInterval(() => {
                        if (this.activeTab === 'downloads') {
                            this.loadDownloadTasks();
                        }
                    }, 5000);
                },
                
                saveSettings() {
                    // ‰øùÂ≠òËÆæÁΩÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                    localStorage.setItem('playSettings', JSON.stringify(this.playSettings));
                    alert('ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
                    console.log('Êí≠ÊîæËÆæÁΩÆÂ∑≤‰øùÂ≠ò:', this.playSettings);
                },
                
                loadSettings() {
                    // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩËÆæÁΩÆ
                    const saved = localStorage.getItem('playSettings');
                    if (saved) {
                        this.playSettings = { ...this.playSettings, ...JSON.parse(saved) };
                        console.log('Êí≠ÊîæËÆæÁΩÆÂ∑≤Âä†ËΩΩ:', this.playSettings);
                    }
                },
                
                // Ê≠åÂçïÁÆ°ÁêÜÁõ∏ÂÖ≥ÊñπÊ≥ï
                async loadUserPlaylists() {
                    this.playlistsLoading = true;
                    try {
                        const response = await axios.get('/api/playlists');
                        this.userPlaylists = response.data.items || response.data;
                        console.log('Áî®Êà∑Ê≠åÂçïÂ∑≤Âä†ËΩΩ:', this.userPlaylists.length, '‰∏™');
                    } catch (error) {
                        console.error('Âä†ËΩΩÁî®Êà∑Ê≠åÂçïÂ§±Ë¥•:', error);
                        alert('Âä†ËΩΩÊ≠åÂçïÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞ÈáçËØï');
                    } finally {
                        this.playlistsLoading = false;
                    }
                },
                
                // ÂàáÊç¢Ê≠åÂçïÂ±ïÂºÄÁä∂ÊÄÅÂπ∂Âä†ËΩΩÊ≠åÊõ≤ËØ¶ÊÉÖ
                async togglePlaylistExpansion(playlist) {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÂΩìÂâçÂ±ïÂºÄÁöÑÊ≠åÂçïÔºåÂàôÊî∂Ëµ∑
                    if (this.currentFavoriteList?.id === playlist.id) {
                        this.currentFavoriteList = null;
                        return;
                    }
                    
                    // ËÆæÁΩÆÂΩìÂâçÊ≠åÂçï
                    this.currentFavoriteList = playlist;
                    
                    // Â¶ÇÊûúÊ≠åÂçïÊ≤°ÊúâËØ¶ÁªÜÁöÑÊ≠åÊõ≤‰ø°ÊÅØÔºåÂàôÂä†ËΩΩ
                    if (!playlist.songs || playlist.songs.length === 0) {
                        this.playlistSongsLoading[playlist.id] = true;
                        try {
                            const response = await axios.get(`/api/playlists/${playlist.id}`);
                            if (response.data.songs) {
                                // Êõ¥Êñ∞Ê≠åÂçï‰∏≠ÁöÑÊ≠åÊõ≤‰ø°ÊÅØ
                                const playlistIndex = this.userPlaylists.findIndex(p => p.id === playlist.id);
                                if (playlistIndex !== -1) {
                                    this.userPlaylists[playlistIndex].songs = response.data.songs;
                                }
                            }
                        } catch (error) {
                            console.error('Âä†ËΩΩÊ≠åÂçïËØ¶ÊÉÖÂ§±Ë¥•:', error);
                            alert('Âä†ËΩΩÊ≠åÂçïËØ¶ÊÉÖÂ§±Ë¥•');
                        } finally {
                            this.playlistSongsLoading[playlist.id] = false;
                        }
                    }
                },
                
                async createPlaylist() {
                    try {
                        const response = await axios.post('/api/playlists/create', this.newPlaylistData);
                        if (response.data.success) {
                            this.showCreatePlaylistModal = false;
                            this.resetNewPlaylistData();
                            await this.loadUserPlaylists();
                            
                            // Â¶ÇÊûúÊòØ‰ªéÊ∑ªÂä†Ê≠åÊõ≤ÊµÅÁ®ãÂàõÂª∫ÁöÑÊ≠åÂçïÔºåÈáçÊñ∞ÊòæÁ§∫Ê∑ªÂä†ÂØπËØùÊ°Ü
                            if (this.selectedTracks.length > 0) {
                                this.selectedPlaylistForAdd = response.data.data.playlist_id;
                                this.showAddToPlaylistModal = true;
                            } else {
                                alert('Ê≠åÂçïÂàõÂª∫ÊàêÂäüÔºÅ');
                            }
                        }
                    } catch (error) {
                        alert('ÂàõÂª∫Ê≠åÂçïÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                async addSelectedToPlaylist() {
                    if (!this.selectedPlaylistForAdd || this.selectedTracks.length === 0) {
                        alert('ËØ∑ÈÄâÊã©Ê≠åÂçïÂíåÊ≠åÊõ≤');
                        return;
                    }
                    
                    try {
                        // ÂØπ‰∫éÊêúÁ¥¢ÁªìÊûúÔºåÊàë‰ª¨ÈúÄË¶ÅÂÖàÂ∞ÜÊ≠åÊõ≤‰ø°ÊÅØ‰º†ÈÄÅÂà∞ÂêéÁ´Ø
                        const selectedSongData = this.searchResults.filter(track => 
                            this.selectedTracks.includes(track.id)
                        );
                        
                        // ÂàõÂª∫‰∏Ä‰∏™ÁâπÊÆäÁöÑAPIË∞ÉÁî®Êù•Â§ÑÁêÜÊêúÁ¥¢ÁªìÊûúÁöÑÊ≠åÊõ≤
                        const response = await axios.post(`/api/playlists/${this.selectedPlaylistForAdd}/add-search-results`, {
                            tracks: selectedSongData
                        });
                        
                        if (response.data.success) {
                            this.showAddToPlaylistModal = false;
                            this.selectedTracks = [];
                            this.selectedPlaylistForAdd = null;
                            await this.loadUserPlaylists(); // ÈáçÊñ∞Âä†ËΩΩÊ≠åÂçï‰ª•Êõ¥Êñ∞Ê≠åÊõ≤Êï∞Èáè
                            alert(response.data.message);
                        }
                    } catch (error) {
                        alert('Ê∑ªÂä†Âà∞Ê≠åÂçïÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                resetNewPlaylistData() {
                    this.newPlaylistData = {
                        name: '',
                        description: '',
                        category: '',
                        country: '',
                        language: '',
                        mood: '',
                        tags: ''
                    };
                },
                
                // ÊâπÈáèÈÄâÊã©Áõ∏ÂÖ≥ÊñπÊ≥ï
                selectNoneTracks() {
                    this.selectedTracks = [];
                },
                
                toggleSelectTracks() {
                    const allIds = this.searchResults.map(track => track.id);
                    const currentSelected = this.selectedTracks;
                    this.selectedTracks = allIds.filter(id => !currentSelected.includes(id));
                },
                
                // Ëé∑ÂèñÊ≠åÊõ≤ÊâÄÂ±ûÁöÑÊ≠åÂçï
                getSongPlaylists(songId) {
                    return this.userPlaylists.filter(playlist => 
                        playlist.songs && playlist.songs.some(song => song.id === songId)
                    );
                },
                
                // ÊòæÁ§∫Ê≠åÂçïËØ¶ÊÉÖ
                showPlaylistDetail(playlistId) {
                    // ÂàáÊç¢Âà∞Êî∂ËóèÈ°µÈù¢ÔºàÁé∞Âú®ÊòØÊ≠åÂçïÈ°µÈù¢Ôºâ
                    this.activeTab = 'favorites';
                    // ÊâæÂà∞ÂØπÂ∫îÁöÑÊ≠åÂçïÂπ∂Â±ïÂºÄ
                    const playlist = this.userPlaylists.find(p => p.id === playlistId);
                    if (playlist) {
                        this.currentFavoriteList = playlist;
                    }
                },
                
                // ÊâìÂºÄÊ∑ªÂä†Âà∞Ê≠åÂçïÊ®°ÊÄÅÊ°Ü
                openAddToPlaylistModal() {
                    if (this.selectedTracks.length === 0) {
                        alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÊ∑ªÂä†ÁöÑÊ≠åÊõ≤');
                        return;
                    }
                    this.showAddToPlaylistModal = true;
                },
                
                // Âà†Èô§Ê≠åÂçï
                async deletePlaylist(playlistId) {
                    if (!playlistId || playlistId === 'undefined') {
                        console.error('Invalid playlist ID:', playlistId);
                        alert('Ê≠åÂçïIDÊó†Êïà');
                        return;
                    }
                    
                    if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ê≠åÂçïÂêóÔºü')) {
                        return;
                    }
                    
                    try {
                        const response = await axios.delete(`/api/playlists/${playlistId}`);
                        if (response.data.success) {
                            await this.loadUserPlaylists();
                            this.currentFavoriteList = null;
                            alert('Ê≠åÂçïÂ∑≤Âà†Èô§');
                        }
                    } catch (error) {
                        console.error('Delete playlist error:', error);
                        alert('Âà†Èô§Ê≠åÂçïÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                // Êí≠ÊîæÊ≠åÂçï‰∏≠ÁöÑÊâÄÊúâÊ≠åÊõ≤
                playAllInPlaylist(playlist) {
                    if (!playlist.songs || playlist.songs.length === 0) {
                        alert('Ê≠åÂçï‰∏∫Á©∫');
                        return;
                    }
                    
                    // ËÆæÁΩÆÊí≠ÊîæÈòüÂàó
                    this.playQueue = [...playlist.songs];
                    this.currentQueueIndex = 0;
                    this.shuffleMode = false;
                    this.playFromQueue(0);
                    console.log(`ÂºÄÂßãÊí≠ÊîæÊ≠åÂçï "${playlist.name}"ÔºåÂÖ± ${playlist.songs.length} È¶ñÊ≠åÊõ≤`);
                },
                
                // ÈöèÊú∫Êí≠ÊîæÊ≠åÂçï
                shufflePlayPlaylist(playlist) {
                    if (!playlist.songs || playlist.songs.length === 0) {
                        alert('Ê≠åÂçï‰∏∫Á©∫');
                        return;
                    }
                    
                    this.playQueue = this.shuffleArray([...playlist.songs]);
                    this.currentQueueIndex = 0;
                    this.shuffleMode = true;
                    this.playFromQueue(0);
                    console.log(`ÂºÄÂßãÈöèÊú∫Êí≠ÊîæÊ≠åÂçï "${playlist.name}"`);
                },
                
                // ‰∏ãËΩΩÊ≠åÂçï‰∏≠ÁöÑÊâÄÊúâÊ≠åÊõ≤
                async downloadAllInPlaylist(playlist) {
                    if (!playlist.songs || playlist.songs.length === 0) {
                        alert('Ê≠åÂçï‰∏∫Á©∫');
                        return;
                    }
                    
                    this.selectedTracks = playlist.songs.map(song => song.spotify_id);
                    await this.downloadSelectedTracks();
                },
                
                // Ê∏ÖÁêÜÁ©∫Ê≠åÂçï
                async cleanupEmptyPlaylists() {
                    if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁêÜÊâÄÊúâÁ©∫Ê≠åÂçïÂêóÔºü')) {
                        return;
                    }
                    
                    try {
                        const response = await axios.delete('/api/playlists/cleanup-empty');
                        if (response.data.success) {
                            await this.loadUserPlaylists();
                            alert(response.data.message);
                        }
                    } catch (error) {
                        alert('Ê∏ÖÁêÜÂ§±Ë¥•: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                toggleRepeatMode() {
                    // Âæ™ÁéØÂàáÊç¢ÈáçÂ§çÊ®°Âºè: none -> all -> single -> none
                    const modes = ['none', 'all', 'single'];
                    const currentIndex = modes.indexOf(this.repeatMode);
                    const nextIndex = (currentIndex + 1) % modes.length;
                    this.repeatMode = modes[nextIndex];
                    console.log(`üîÑ ÈáçÂ§çÊ®°ÂºèÂ∑≤ÂàáÊç¢‰∏∫: ${this.repeatMode}`);
                },
                
                toggleShuffleMode() {
                    this.shuffleMode = !this.shuffleMode;
                    console.log(`üîÄ ÈöèÊú∫Êí≠ÊîæÊ®°Âºè: ${this.shuffleMode ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠'}`);
                    
                    // Â¶ÇÊûúÂºÄÂêØÈöèÊú∫Ê®°Âºè‰∏îÊúâÊí≠ÊîæÈòüÂàóÔºåÈáçÊñ∞Êâì‰π±
                    if (this.shuffleMode && this.playQueue.length > 0) {
                        const currentTrack = this.playQueue[this.currentQueueIndex];
                        this.playQueue = this.shuffleArray(this.playQueue);
                        // ÊâæÂà∞ÂΩìÂâçÊí≠ÊîæÊ≠åÊõ≤ÁöÑÊñ∞‰ΩçÁΩÆ
                        this.currentQueueIndex = this.playQueue.findIndex(track => track.id === currentTrack.id);
                    }
                },
                
                getRepeatIcon() {
                    switch (this.repeatMode) {
                        case 'none':
                            return 'fas fa-retweet text-gray-600';
                        case 'all':
                            return 'fas fa-retweet text-blue-600';
                        case 'single':
                            return 'fas fa-redo text-blue-600';
                        default:
                            return 'fas fa-retweet text-gray-600';
                    }
                },
                
                getRepeatTitle() {
                    switch (this.repeatMode) {
                        case 'none':
                            return 'Êó†ÈáçÂ§ç';
                        case 'all':
                            return 'ÂàóË°®Âæ™ÁéØ';
                        case 'single':
                            return 'ÂçïÊõ≤Âæ™ÁéØ';
                        default:
                            return 'Êó†ÈáçÂ§ç';
                    }
                },
                
                // ÊêúÁ¥¢ËæìÂÖ•Èò≤ÊäñÂ§ÑÁêÜ
                onSearchInput() {
                    // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
                    if (this.searchDebounceTimer) {
                        clearTimeout(this.searchDebounceTimer);
                    }
                    
                    // ËÆæÁΩÆÊñ∞ÁöÑÂÆöÊó∂Âô®Ôºå500ms Âª∂Ëøü
                    this.searchDebounceTimer = setTimeout(() => {
                        if (this.searchQuery && this.searchQuery.trim().length > 2) {
                            this.searchMusic();
                        }
                    }, 500);
                },
                
                // Âä†ËΩΩÊêúÁ¥¢ÂéÜÂè≤
                loadSearchHistory() {
                    try {
                        const saved = localStorage.getItem('searchHistory');
                        if (saved) {
                            this.searchHistory = JSON.parse(saved);
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩÊêúÁ¥¢ÂéÜÂè≤Â§±Ë¥•:', error);
                        this.searchHistory = [];
                    }
                },
                
                // Ê∑ªÂä†Âà∞ÊêúÁ¥¢ÂéÜÂè≤
                addToSearchHistory(query) {
                    if (!query || query.trim() === '') return;
                    
                    const trimmedQuery = query.trim();
                    
                    // ÁßªÈô§ÈáçÂ§çÁöÑÂéÜÂè≤ËÆ∞ÂΩï
                    const existingIndex = this.searchHistory.findIndex(item => 
                        item.query.toLowerCase() === trimmedQuery.toLowerCase()
                    );
                    
                    if (existingIndex !== -1) {
                        this.searchHistory.splice(existingIndex, 1);
                    }
                    
                    // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩïÈ°∂ÈÉ®
                    this.searchHistory.unshift({
                        query: trimmedQuery,
                        timestamp: Date.now()
                    });
                    
                    // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè‰∏∫ 20 Êù°
                    if (this.searchHistory.length > 20) {
                        this.searchHistory = this.searchHistory.slice(0, 20);
                    }
                    
                    // ‰øùÂ≠òÂà∞ localStorage
                    localStorage.setItem('searchHistory', JSON.stringify(this.searchHistory));
                },
                
                // Ê∏ÖÁ©∫ÊêúÁ¥¢ÂéÜÂè≤
                clearSearchHistory() {
                    this.searchHistory = [];
                    localStorage.removeItem('searchHistory');
                },
                
                // ‰ªéÊêúÁ¥¢ÂéÜÂè≤‰∏≠ÈÄâÊã©
                selectFromHistory(query) {
                    this.searchQuery = query;
                    this.searchMusic();
                },
                
                // Âª∂ËøüÈöêËóèÊêúÁ¥¢ÂéÜÂè≤
                hideSearchHistoryWithDelay() {
                    setTimeout(() => {
                        this.showSearchHistory = false;
                    }, 150);
                },
                
                // Ê∏ÖÁêÜËøáÊúüÁöÑÊêúÁ¥¢ÁºìÂ≠ò
                cleanExpiredCache() {
                    const now = Date.now();
                    const CACHE_EXPIRE_TIME = 30 * 60 * 1000; // 30ÂàÜÈíüËøáÊúü
                    
                    for (const [key, value] of this.searchCache.entries()) {
                        if (now - value.timestamp > CACHE_EXPIRE_TIME) {
                            this.searchCache.delete(key);
                        }
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>